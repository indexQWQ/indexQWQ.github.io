import{l as t}from"../waifu-tips.js";class e{constructor(e=0){e<1?(this._ptr=[],this._capacity=0):(this._ptr=new Array(e),this._capacity=e),this._size=0}at(e){return this._ptr[e]}set(e,t){this._ptr[e]=t}get(t=0){var i=new Array;for(let e=t;e<this._size;e++)i.push(this._ptr[e]);return i}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?e.DefaultSize:2*this._capacity),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,i){this._size<t&&this.prepareCapacity(t);for(let e=0;e<t;e++)this._ptr[e]=i;this._size=t}resize(e,t=null){this.updateSize(e,t,!0)}updateSize(t,i=null,e=!0){if(this._size<t)if(this.prepareCapacity(t),e)for(let e=this._size;e<t;e++)this._ptr[e]="function"==typeof i?JSON.parse(JSON.stringify(new i)):i;else for(let e=this._size;e<t;e++)this._ptr[e]=i;else{let e=this._size-t;this._ptr.splice(this._size-e,e)}this._size=t}insert(t,i,e){let s=t._index;var t=i._index,r=e._index,e=r-t,a=(this.prepareCapacity(this._size+e),this._size-s);if(0<a)for(let e=0;e<a;e++)this._ptr.splice(s+e,0,null);for(let e=t;e<r;e++,s++)this._ptr[s]=i._vector._ptr[e];this._size=this._size+e}remove(e){return!(e<0||this._size<=e||(this._ptr.splice(e,1),--this._size,0))}erase(e){var t=e._index;return t<0||this._size<=t?e:(this._ptr.splice(t,1),--this._size,new i(this,t))}prepareCapacity(e){e>this._capacity&&(0==this._capacity?this._ptr=new Array(e):this._ptr.length=e,this._capacity=e)}begin(){return 0==this._size?this.end():new i(this,0)}end(){return new i(this,this._size)}getOffset(t){var i=new e;return i._ptr=this.get(t),i._size=this.get(t).length,i._capacity=this.get(t).length,i}}e.DefaultSize=10;let i=class t{constructor(e,t){this._vector=null!=e?e:null,this._index=null!=t?t:0}set(e){return this._index=e._index,this._vector=e._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new t(this._vector,this._index++)}decrement(){return new t(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(e){return this._index=e._index,this._vector=e._vector,this}notEqual(e){return this._index!=e._index||this._vector!=e._vector}};var s,r,a,n,o,l,h,u,B,w,G,K,Q,lt,ht,ut,gt,dt,_t,ct,bt,Pt,Bt,wt,Rt,Tt,kt,Nt,zt,jt,Ht,qt,Wt,Jt,ue,ge,Ce,xe,Me,ve,be,Pe,ti,Si,Pi,Ti,Ui,Gi,Xi,Qi,is,ss,hs,us;(t=>{t.csmVector=e,t.iterator=i})(s=s||{});class g{append(e,t){return this.s+=void 0!==t?e.substr(0,t):e,this}expansion(t,i){for(let e=0;e<t;e++)this.append(i);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(e){return this.s<e.s}isGreat(e){return this.s>e.s}isEqual(e){return this.s==e}isEmpty(){return 0==this.s.length}constructor(e){this.s=e}}(r=r||{}).csmString=g;class d{static createIdInternal(e){return new d(e)}getString(){return this._id}isEqual(e){return"string"==typeof e?this._id.isEqual(e):e instanceof g?this._id.isEqual(e.s):e instanceof d&&this._id.isEqual(e._id.s)}isNotEqual(e){return"string"==typeof e?!this._id.isEqual(e):e instanceof g?!this._id.isEqual(e.s):e instanceof d&&!this._id.isEqual(e._id.s)}constructor(e){this._id="string"!=typeof e?e:new g(e)}}(a=a||{}).CubismId=d;class _{constructor(){this._ids=new e}release(){for(let e=0;e<this._ids.getSize();++e)this._ids.set(e,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(e){let t=null;return"string"!=typeof e?this.registerId(e.s):(null==(t=this.findId(e))&&(t=d.createIdInternal(e),this._ids.pushBack(t)),t)}getId(e){return this.registerId(e)}isExist(e){return"string"==typeof e?null!=this.findId(e):this.isExist(e.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}(n=n||{}).CubismIdManager=_;class c{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(s,r,t){var a=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let t=0;t<4;++t)for(let e=0;e<4;++e)a[t+4*i]+=s[e+4*i]*r[t+4*e];for(let e=0;e<16;++e)t[e]=a[e]}loadIdentity(){var e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);c.multiply(e,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){e=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);c.multiply(e,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){c.multiply(e.getArray(),this._tr,this._tr)}clone(){var t=new c;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}(o=o||{}).CubismMatrix44=c;class m{constructor(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t}}(l=l||{}).csmRect=m;class p{static create(){return null}static delete(e){}initialize(e){this._model=e}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,i,s){e<0?e=0:1<e&&(e=1),t<0?t=0:1<t&&(t=1),i<0?i=0:1<i&&(i=1),s<0?s=0:1<s&&(s=1),this._modelColor.r=e,this._modelColor.g=t,this._modelColor.b=i,this._modelColor.a=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(e){var t=this.getModelColor();return t.a*=e,this.isPremultipliedAlpha()&&(t.r*=t.a,t.g*=t.a,t.b*=t.a),t}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisotropy=e}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(e){this._useHighPrecisionMask=e}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new f,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new c,this._mvpMatrix4x4.loadIdentity()}}(e=>{e[e.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",e[e.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",e[e.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative"})(h=h||{});class f{constructor(e=1,t=1,i=1,s=1){this.r=e,this.g=t,this.b=i,this.a=s}}class y{constructor(e,t){this._clippingIdList=e,this._clippingIdCount=t,this._allClippedDrawRect=new m,this._layoutBounds=new m,this._clippedDrawableIndexList=[],this._matrixForMask=new c,this._matrixForDraw=new c,this._bufferIndex=0}release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}}(e=>{e.CubismBlendMode=h,e.CubismRenderer=p,e.CubismTextureColor=f})(u=u||{});let S=(e,t,i)=>{e=e,t=t+"\n",i=i,P.print(e,"[CSM]"+t,i)},C=e=>{console.assert(e)},x,M,v,b;x=(e,...t)=>{S(K.LogLevel_Debug,"[D]"+e,t)},M=(e,...t)=>{S(K.LogLevel_Info,"[I]"+e,t)},v=(e,...t)=>{S(K.LogLevel_Warning,"[W]"+e,t)},b=(e,...t)=>{S(K.LogLevel_Error,"[E]"+e,t)};class P{static print(e,t,i){e<$.getLoggingLevel()||(e=$.coreLogFunction)&&e(t.replace(/\{(\d+)\}/g,(e,t)=>i[t]))}static dumpBytes(t,i,s){for(let e=0;e<s;e++)e%16==0&&0<e?this.print(t,"\n"):e%8==0&&0<e&&this.print(t,"  "),this.print(t,"{0} ",[255&i[e]]);this.print(t,"\n")}constructor(){}}(B=B||{}).CubismDebug=P;class F{constructor(e,t){this.first=null==e?null:e,this.second=null==t?null:t}}class I{constructor(e){null==e||e<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(e),this._size=e)}release(){this.clear()}appendKey(t){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}-1==i?(this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new F(t),this._size+=1):v("The key `{0}` is already append.",t)}getValue(t){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}return(0<=i?this._keyValues[i]:(this.appendKey(t),this._keyValues[this._size-1])).second}setValue(t,e){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}0<=i?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(e,t){e>this._keyValues.length&&(0==this._keyValues.length?!t&&e<I.DefaultSize&&(e=I.DefaultSize):!t&&e<2*this._keyValues.length&&(e=2*this._keyValues.length),this._keyValues.length=e)}begin(){return new V(this,0)}end(){return new V(this,this._size)}erase(e){var t=e._index;return t<0||this._size<=t?e:(this._keyValues.splice(t,1),--this._size,new V(this,t))}dumpAsInt(){for(let e=0;e<this._size;e++)x("{0} ,",this._keyValues[e]),x("\n")}}I.DefaultSize=10;class V{constructor(e,t){this._map=null!=e?e:new I,this._index=null!=t?t:0}set(e){return this._index=e._index,this._map=e._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new V(this._map,this._index++)}decrement(){var e=new V(this._map,this._index);return this._map=e._map,this._index=e._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(e){return this._index!=e._index||this._map!=e._map}}(e=>{e.csmMap=I,e.csmPair=F,e.iterator=V})(w=w||{});class E{static parseJsonObject(i,s){return Object.keys(i).forEach(e=>{var t;"boolean"==typeof i[e]?(t=Boolean(i[e]),s.put(e,new A(t))):"string"==typeof i[e]?(t=String(i[e]),s.put(e,new O(t))):"number"==typeof i[e]?(t=Number(i[e]),s.put(e,new D(t))):i[e]instanceof Array?s.put(e,E.parseJsonArray(i[e])):i[e]instanceof Object?s.put(e,E.parseJsonObject(i[e],new U)):null==i[e]?s.put(e,new N):s.put(e,i[e])}),s}static parseJsonArray(s){let r=new z;return Object.keys(s).forEach(e=>{var t;if("number"==typeof Number(e))"boolean"==typeof s[e]?(t=Boolean(s[e]),r.add(new A(t))):"string"==typeof s[e]?(t=String(s[e]),r.add(new O(t))):"number"==typeof s[e]?(t=Number(s[e]),r.add(new D(t))):s[e]instanceof Array?r.add(this.parseJsonArray(s[e])):s[e]instanceof Object?r.add(this.parseJsonObject(s[e],new U)):null==s[e]?r.add(new N):r.add(s[e]);else if(s[e]instanceof Array)r.add(this.parseJsonArray(s[e]));else if(s[e]instanceof Object)r.add(this.parseJsonObject(s[e],new U));else if(null==s[e])r.add(new N);else{var i=Array(s[e]);for(let e=0;e<i.length;e++)r.add(i[e])}}),r}}let R="Error: type mismatch",T=class t{constructor(){}getRawString(e,t){return this.getString(e,t)}toInt(e=0){return e}toFloat(e=0){return e}toBoolean(e=!1){return e}getSize(){return 0}getArray(e=null){return e}getVector(t=new e){return t}getMap(e){return e}getValueByIndex(e){return t.errorValue.setErrorNotForClientCall(R)}getValueByString(e){return t.nullValue.setErrorNotForClientCall(R)}getKeys(){return t.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(e){return!1}isStatic(){return!1}setErrorNotForClientCall(e){return k.errorValue}static staticInitializeNotForClientCall(){A.trueValue=new A(!0),A.falseValue=new A(!1),t.errorValue=new k("ERROR",!0),t.nullValue=new N,t.dummyKeys=new e}static staticReleaseNotForClientCall(){A.trueValue=null,A.falseValue=null,t.errorValue=null,t.nullValue=null,t.dummyKeys=null}};class L{constructor(e,t){this._parseCallback=E.parseJsonObject,this._error=null,this._lineCount=0,(this._root=null)!=e&&this.parseBytes(e,t,this._parseCallback)}static create(e,t){var i=new L;return i.parseBytes(e,t,i._parseCallback)?i:(L.delete(i),null)}static delete(e){}getRoot(){return this._root}static arrayBufferToString(e){var i=new Uint8Array(e);let s="";for(let e=0,t=i.length;e<t;++e)s+="%"+this.pad(i[e].toString(16));return s=decodeURIComponent(s)}static pad(e){return e.length<2?"0"+e:e}parseBytes(e,t,i){var s=new Array(1),e=L.arrayBufferToString(e);return this._root=null==i?this.parseValue(e,t,0,s):i(JSON.parse(e),new U),this._error?(t="\0",t="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new O(t),M("{0}",this._root.getRawString()),!1):null!=this._root||(this._root=new k(new g(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(s,r,a,n){if(!this._error){let t,e=null,i=a;for(;i<r;i++)switch(s[i]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{let e=new Array(1);return t=X(s.slice(i),e),n[0]=s.indexOf(e[0]),new D(t)}case'"':return new O(this.parseString(s,r,i+1,n));case"[":return e=this.parseArray(s,r,i+1,n);case"{":return e=this.parseObject(s,r,i+1,n);case"n":return i+3<r?(e=new N,n[0]=i+4):this._error="parse null",e;case"t":return i+3<r?(e=A.trueValue,n[0]=i+4):this._error="parse true",e;case"f":return i+4<r?(e=A.falseValue,n[0]=i+5):this._error="illegal ',' position",e;case",":return this._error="illegal ',' position",null;case"]":return n[0]=i,null;case"\n":this._lineCount++}this._error="illegal end of value"}return null}parseString(r,a,n,o){if(!this._error)if(r){let e,t,i=n;var l=new g("");let s=n;for(;i<a;i++)switch(e=r[i],e){case'"':return o[0]=i+1,l.append(r.slice(s),i-s),l.s;case"//":if(++i-1>s&&l.append(r.slice(s),i-s),s=i+1,i<a)switch(t=r[i],t){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,"\n");break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}this._error="parse string/illegal end"}else this._error="string is null";return null}parseObject(a,n,e,o){if(!this._error)if(a){var l=new U;let t="",i=e,s="";var h=Array(1);let r=!1;for(;i<n;i++){e:for(;i<n;i++)switch(s=a[i],s){case'"':if(t=this.parseString(a,n,i+1,h),this._error)return null;i=h[0],r=!0;break e;case"}":return o[0]=i+1,l;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!r)return this._error="key not found",null;r=!1;e:for(;i<n;i++)switch(s=a[i],s){case":":r=!0,i++;break e;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!r)return this._error="':' not found",null;let e=this.parseValue(a,n,i,h);if(this._error)return null;i=h[0],l.put(t,e);e:for(;i<n;i++)switch(s=a[i],s){case",":break e;case"}":return o[0]=i+1,l;case"\n":this._lineCount++}}this._error="illegal end of perseObject"}else this._error="buffer is null";return null}parseArray(r,a,e,n){if(!this._error)if(r){let t,i=new z,s=e;for(var o=new Array(1);s<a;s++){let e=this.parseValue(r,a,s,o);if(this._error)return null;s=o[0],e&&i.add(e);e:for(;s<a;s++)switch(t=r[s],t){case",":break e;case"]":return n[0]=s+1,i;case"\n":++this._lineCount}}i=void 0,this._error="illegal end of parseObject"}else this._error="buffer is null";return null}}class D extends T{constructor(e){super(),this._value=e}isFloat(){return!0}getString(e,t){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(e=0){return parseInt(this._value.toString())}toFloat(e=0){return this._value}equals(e){return"number"==typeof e&&!Math.round(e)&&e==this._value}}class A extends T{isBool(){return!0}toBoolean(e=0){return this._boolValue}getString(e,t){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(e){return"boolean"==typeof e&&e==this._boolValue}isStatic(){return!0}constructor(e){super(),this._boolValue=e}}class O extends T{constructor(e){super(),"string"==typeof e&&(this._stringBuffer=e),e instanceof g&&(this._stringBuffer=e.s)}isString(){return!0}getString(e,t){return this._stringBuffer}equals(e){return"string"==typeof e?this._stringBuffer==e:e instanceof g&&this._stringBuffer==e.s}}class k extends O{isStatic(){return this._isStatic}setErrorNotForClientCall(e){return this._stringBuffer=e,this}constructor(e,t){super(e),this._isStatic=t}isError(){return!0}}class N extends T{isNull(){return!0}getString(e,t){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(e){return this._stringBuffer=e,k.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class z extends T{constructor(){super(),this._array=new e}release(){for(var t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(e){return e<0||this._array.getSize()<=e?T.errorValue.setErrorNotForClientCall("Error: index out of bounds"):null==(e=this._array.at(e))?T.nullValue:e}getValueByString(e){return T.errorValue.setErrorNotForClientCall(R)}getString(e,t){let i=t+"[\n";for(var s=this._array.begin();s.notEqual(this._array.end());s.increment()){let e=s.ptr();this._stringBuffer+=t+""+e.getString(t+" ")+"\n"}return this._stringBuffer=i+t+"]\n",this._stringBuffer}add(e){this._array.pushBack(e)}getVector(e=0){return this._array}getSize(){return this._array.getSize()}}class U extends T{constructor(){super(),this._map=new I}release(){for(var t=this._map.begin();t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(e){var t;if(e instanceof g)return null==(t=this._map.getValue(e.s))?T.nullValue:t;for(var i=this._map.begin();i.notEqual(this._map.end());i.preIncrement())if(i.ptr().first==e)return null==i.ptr().second?T.nullValue:i.ptr().second;return T.nullValue}getValueByIndex(e){return T.errorValue.setErrorNotForClientCall(R)}getString(e,i){this._stringBuffer=i+"{\n";for(var s=this._map.begin();s.notEqual(this._map.end());){let e=s.ptr().first,t=s.ptr().second;this._stringBuffer+=i+" "+e+" : "+t.getString(i+"   ")+" \n",s.preIncrement()}return this._stringBuffer+=i+"}\n",this._stringBuffer}getMap(e){return this._map}put(e,t){this._map.setValue(e,t)}getKeys(){if(!this._keys){this._keys=new e;for(var t=this._map.begin();t.notEqual(this._map.end());){let e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}function X(i,e){let s=0;for(let t=1;;t++){let e=i.slice(t-1,t);if("e"!=e&&"-"!=e&&"E"!=e){var r=i.substring(0,t),r=Number(r);if(isNaN(r))break;s=t}}let t=parseFloat(i);return isNaN(t)&&(t=NaN),e[0]=i.slice(s),t}(e=>{e.CubismJson=L,e.JsonArray=z,e.JsonBoolean=A,e.JsonError=k,e.JsonFloat=D,e.JsonMap=U,e.JsonNullvalue=N,e.JsonString=O,e.Value=T})(G=G||{});let Y=!1,j=!1,H=null,q=null,W=Object.freeze({vertexOffset:0,vertexStep:2});function J(e){}class ${static startUp(e=null){if(Y)M("CubismFramework.startUp() is already done.");else{if(null!=(H=e)&&Live2DCubismCore.Logging.csmSetLogFunction(H.logFunction),Y=!0){let e=Live2DCubismCore.Version.csmGetVersion(),t=(16711680&e)>>16,i=65535&e,s=e;M("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&e)>>24)).slice(-2),("00"+t).slice(-2),("0000"+i).slice(-4),s)}M("CubismFramework.startUp() is complete.")}return Y}static cleanUp(){Y=!1,j=!1,H=null,q=null}static initialize(e=0){C(Y),Y?j?v("CubismFramework.initialize() skipped, already initialized."):(T.staticInitializeNotForClientCall(),q=new _,Live2DCubismCore.Memory.initializeAmountOfMemory(e),j=!0,M("CubismFramework.initialize() is complete.")):v("CubismFramework is not started.")}static dispose(){C(Y),Y?j?(T.staticReleaseNotForClientCall(),q.release(),q=null,p.staticRelease(),j=!1,M("CubismFramework.dispose() is complete.")):v("CubismFramework.dispose() skipped, not initialized."):v("CubismFramework is not started.")}static isStarted(){return Y}static isInitialized(){return j}static coreLogFunction(e){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return null!=H?H.loggingLevel:K.LogLevel_Off}static getIdManager(){return q}constructor(){}}class Z{}(e=>{e[e.LogLevel_Verbose=0]="LogLevel_Verbose",e[e.LogLevel_Debug=1]="LogLevel_Debug",e[e.LogLevel_Info=2]="LogLevel_Info",e[e.LogLevel_Warning=3]="LogLevel_Warning",e[e.LogLevel_Error=4]="LogLevel_Error",e[e.LogLevel_Off=5]="LogLevel_Off"})(K=K||{}),(e=>{e.Constant=W,e.csmDelete=J,e.CubismFramework=$})(Q=Q||{});let tt="../../Resources/",et=["Haru","Hiyori","Mark","Natori","Rice","Mao","Wanko"],it=et.length,st="Body",rt=K.LogLevel_Verbose;class at{static loadFileAsBytes(e,t){fetch(e).then(e=>e.arrayBuffer()).then(e=>t(e,e.byteLength))}static getDeltaTime(){return this.deltaTime}static updateTime(){this.currentFrame=Date.now(),this.deltaTime=(this.currentFrame-this.lastFrame)/1e3,this.lastFrame=this.currentFrame}static printMessage(e){console.trace(e)}}at.lastUpdate=Date.now(),at.currentFrame=0,at.lastFrame=0,at.deltaTime=0;class nt{constructor(){this._gl=null,this._gl=null}initialize(e){return this._gl=e.getContext("webgl2"),!!this._gl||(alert("Cannot initialize WebGL. This browser does not support."),this._gl=null,!1)}release(){}getGl(){return this._gl}}let ot=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});(e=>{e.HitAreaBody=ot.HitAreaBody,e.HitAreaHead=ot.HitAreaHead,e.HitAreaPrefix=ot.HitAreaPrefix,e.ParamAngleX=ot.ParamAngleX,e.ParamAngleY=ot.ParamAngleY,e.ParamAngleZ=ot.ParamAngleZ,e.ParamArmLA=ot.ParamArmLA,e.ParamArmLB=ot.ParamArmLB,e.ParamArmRA=ot.ParamArmRA,e.ParamArmRB=ot.ParamArmRB,e.ParamBaseX=ot.ParamBaseX,e.ParamBaseY=ot.ParamBaseY,e.ParamBodyAngleX=ot.ParamBodyAngleX,e.ParamBodyAngleY=ot.ParamBodyAngleY,e.ParamBodyAngleZ=ot.ParamBodyAngleZ,e.ParamBreath=ot.ParamBreath,e.ParamBrowLAngle=ot.ParamBrowLAngle,e.ParamBrowLForm=ot.ParamBrowLForm,e.ParamBrowLX=ot.ParamBrowLX,e.ParamBrowLY=ot.ParamBrowLY,e.ParamBrowRAngle=ot.ParamBrowRAngle,e.ParamBrowRForm=ot.ParamBrowRForm,e.ParamBrowRX=ot.ParamBrowRX,e.ParamBrowRY=ot.ParamBrowRY,e.ParamBustX=ot.ParamBustX,e.ParamBustY=ot.ParamBustY,e.ParamCheek=ot.ParamCheek,e.ParamEyeBallForm=ot.ParamEyeBallForm,e.ParamEyeBallX=ot.ParamEyeBallX,e.ParamEyeBallY=ot.ParamEyeBallY,e.ParamEyeLOpen=ot.ParamEyeLOpen,e.ParamEyeLSmile=ot.ParamEyeLSmile,e.ParamEyeROpen=ot.ParamEyeROpen,e.ParamEyeRSmile=ot.ParamEyeRSmile,e.ParamHairBack=ot.ParamHairBack,e.ParamHairFluffy=ot.ParamHairFluffy,e.ParamHairFront=ot.ParamHairFront,e.ParamHairSide=ot.ParamHairSide,e.ParamHandL=ot.ParamHandL,e.ParamHandR=ot.ParamHandR,e.ParamMouthForm=ot.ParamMouthForm,e.ParamMouthOpenY=ot.ParamMouthOpenY,e.ParamNONE=ot.ParamNONE,e.ParamShoulderY=ot.ParamShoulderY,e.PartsArmLPrefix=ot.PartsArmLPrefix,e.PartsArmPrefix=ot.PartsArmPrefix,e.PartsArmRPrefix=ot.PartsArmRPrefix,e.PartsIdCore=ot.PartsIdCore})(lt=lt||{});class mt{}(ht=ht||{}).ICubismModelSetting=mt,(e=>{e[e.FrequestNode_Groups=0]="FrequestNode_Groups",e[e.FrequestNode_Moc=1]="FrequestNode_Moc",e[e.FrequestNode_Motions=2]="FrequestNode_Motions",e[e.FrequestNode_Expressions=3]="FrequestNode_Expressions",e[e.FrequestNode_Textures=4]="FrequestNode_Textures",e[e.FrequestNode_Physics=5]="FrequestNode_Physics",e[e.FrequestNode_Pose=6]="FrequestNode_Pose",e[e.FrequestNode_HitAreas=7]="FrequestNode_HitAreas"})(ut=ut||{});class pt extends mt{constructor(t,i){super(),this.version="Version",this.fileReferences="FileReferences",this.groups="Groups",this.layout="Layout",this.hitAreas="HitAreas",this.moc="Moc",this.textures="Textures",this.physics="Physics",this.pose="Pose",this.expressions="Expressions",this.motions="Motions",this.userData="UserData",this.name="Name",this.filePath="File",this.id="Id",this.ids="Ids",this.target="Target",this.idle="Idle",this.tapBody="TapBody",this.pinchIn="PinchIn",this.pinchOut="PinchOut",this.shake="Shake",this.flickHead="FlickHead",this.parameter="Parameter",this.soundPath="Sound",this.fadeInTime="FadeInTime",this.fadeOutTime="FadeOutTime",this.centerX="CenterX",this.centerY="CenterY",this.x="X",this.y="Y",this.width="Width",this.height="Height",this.lipSync="LipSync",this.eyeBlink="EyeBlink",this.initParameter="init_param",this.initPartsVisible="init_parts_visible",this.val="val",this._json=L.create(t,i),this.getJson()&&(this._jsonValue=new e,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.groups)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.moc)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.motions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.expressions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.textures)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.physics)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.pose)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.hitAreas)))}release(){L.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(ut.FrequestNode_Moc).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(ut.FrequestNode_Textures).getSize():0}getTextureDirectory(){var t=this._jsonValue.at(ut.FrequestNode_Textures).getValueByIndex(0).getRawString().split("/"),i=t.length-1;let s="";for(let e=0;e<i;e++)s+=t[e],e<i-1&&(s+="/");return s}getTextureFileName(e){return this._jsonValue.at(ut.FrequestNode_Textures).getValueByIndex(e).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(ut.FrequestNode_HitAreas).getSize():0}getHitAreaId(e){return $.getIdManager().getId(this._jsonValue.at(ut.FrequestNode_HitAreas).getValueByIndex(e).getValueByString(this.id).getRawString())}getHitAreaName(e){return this._jsonValue.at(ut.FrequestNode_HitAreas).getValueByIndex(e).getValueByString(this.name).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(ut.FrequestNode_Physics).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(ut.FrequestNode_Pose).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(ut.FrequestNode_Expressions).getSize():0}getExpressionName(e){return this._jsonValue.at(ut.FrequestNode_Expressions).getValueByIndex(e).getValueByString(this.name).getRawString()}getExpressionFileName(e){return this._jsonValue.at(ut.FrequestNode_Expressions).getValueByIndex(e).getValueByString(this.filePath).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(ut.FrequestNode_Motions).getKeys().getSize():0}getMotionGroupName(e){return this.isExistMotionGroups()?this._jsonValue.at(ut.FrequestNode_Motions).getKeys().at(e):null}getMotionCount(e){return this.isExistMotionGroupName(e)?this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getSize():0}getMotionFileName(e,t){return this.isExistMotionGroupName(e)?this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.filePath).getRawString():""}getMotionSoundFileName(e,t){return this.isExistMotionSoundFile(e,t)?this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.soundPath).getRawString():""}getMotionFadeInTimeValue(e,t){return this.isExistMotionFadeIn(e,t)?this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.fadeInTime).toFloat():-1}getMotionFadeOutTimeValue(e,t){return this.isExistMotionFadeOut(e,t)?this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.fadeOutTime).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData).getRawString():""}getLayoutMap(e){var t=this.getJson().getRoot().getValueByString(this.layout).getMap();if(null==t)return!1;let i=!1;for(var s=t.begin();s.notEqual(t.end());s.preIncrement())e.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();e++){var i=this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(this.name).getRawString()==this.eyeBlink){t=i.getValueByString(this.ids).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(this.isExistEyeBlinkParameters())for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();e++){var i=this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(this.name).getRawString()==this.eyeBlink)return $.getIdManager().getId(i.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();e++){var i=this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(this.name).getRawString()==this.lipSync){t=i.getValueByString(this.ids).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(this.isExistLipSyncParameters())for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();e++){var i=this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(this.name).getRawString()==this.lipSync)return $.getIdManager().getId(i.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}isExistModelFile(){var e=this._jsonValue.at(ut.FrequestNode_Moc);return!e.isNull()&&!e.isError()}isExistTextureFiles(){var e=this._jsonValue.at(ut.FrequestNode_Textures);return!e.isNull()&&!e.isError()}isExistHitAreas(){var e=this._jsonValue.at(ut.FrequestNode_HitAreas);return!e.isNull()&&!e.isError()}isExistPhysicsFile(){var e=this._jsonValue.at(ut.FrequestNode_Physics);return!e.isNull()&&!e.isError()}isExistPoseFile(){var e=this._jsonValue.at(ut.FrequestNode_Pose);return!e.isNull()&&!e.isError()}isExistExpressionFile(){var e=this._jsonValue.at(ut.FrequestNode_Expressions);return!e.isNull()&&!e.isError()}isExistMotionGroups(){var e=this._jsonValue.at(ut.FrequestNode_Motions);return!e.isNull()&&!e.isError()}isExistMotionGroupName(e){e=this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(e,t){e=this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.soundPath);return!e.isNull()&&!e.isError()}isExistMotionFadeIn(e,t){e=this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.fadeInTime);return!e.isNull()&&!e.isError()}isExistMotionFadeOut(e,t){e=this._jsonValue.at(ut.FrequestNode_Motions).getValueByString(e).getValueByIndex(t).getValueByString(this.fadeOutTime);return!e.isNull()&&!e.isError()}isExistUserDataFile(){var e=this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData);return!e.isNull()&&!e.isError()}isExistEyeBlinkParameters(){if(!this._jsonValue.at(ut.FrequestNode_Groups).isNull()&&!this._jsonValue.at(ut.FrequestNode_Groups).isError())for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();++e)if(this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e).getValueByString(this.name).getRawString()==this.eyeBlink)return!0;return!1}isExistLipSyncParameters(){if(!this._jsonValue.at(ut.FrequestNode_Groups).isNull()&&!this._jsonValue.at(ut.FrequestNode_Groups).isError())for(let e=0;e<this._jsonValue.at(ut.FrequestNode_Groups).getSize();++e)if(this._jsonValue.at(ut.FrequestNode_Groups).getValueByIndex(e).getValueByString(this.name).getRawString()==this.lipSync)return!0;return!1}}(e=>{e.CubismModelSettingJson=pt,e.FrequestNode=ut})(gt=gt||{});class ft{static create(){return new ft}static delete(e){}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;var i=2*this._currentTime*Math.PI;for(let e=0;e<this._breathParameters.getSize();++e){var s=this._breathParameters.at(e);t.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}constructor(){this._currentTime=0}}class yt{constructor(e,t,i,s,r){this.parameterId=null==e?null:e,this.offset=null==t?0:t,this.peak=null==i?0:i,this.cycle=null==s?0:s,this.weight=null==r?0:r}}(e=>{e.BreathParameterData=yt,e.CubismBreath=ft})(dt=dt||{});class St{static create(e=null){return new St(e)}static delete(e){}setBlinkingInterval(e){this._blinkingIntervalSeconds=e}setBlinkingSetting(e,t,i){this._closingSeconds=e,this._closedSeconds=t,this._openingSeconds=i}setParameterIds(e){this._parameterIds=e}getParameterIds(){return this._parameterIds}updateParameters(t,e){let i,s=(this._userTimeSeconds+=e,0);switch(this._blinkingState){case _t.EyeState_Closing:1<=(s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds)&&(s=1,this._blinkingState=_t.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case _t.EyeState_Closed:1<=(s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds)&&(this._blinkingState=_t.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case _t.EyeState_Opening:1<=(s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds)&&(s=1,this._blinkingState=_t.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case _t.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=_t.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;default:this._blinkingState=_t.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}St.CloseIfZero||(i=-i);for(let e=0;e<this._parameterIds.getSize();++e)t.setParameterValueById(this._parameterIds.at(e),i)}constructor(t){if(this._blinkingState=_t.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new e,null!=t)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){var e=Math.random();return this._userTimeSeconds+e*(2*this._blinkingIntervalSeconds-1)}}St.CloseIfZero=!0,(e=>{e[e.EyeState_First=0]="EyeState_First",e[e.EyeState_Interval=1]="EyeState_Interval",e[e.EyeState_Closing=2]="EyeState_Closing",e[e.EyeState_Closed=3]="EyeState_Closed",e[e.EyeState_Opening=4]="EyeState_Opening"})(_t=_t||{}),(e=>{e.CubismEyeBlink=St,e.EyeState=_t})(ct=ct||{});let Ct="FadeInTime",xt="Link";class Mt{static create(e,t){let i=L.create(e,t);if(!i)return null;let n=new Mt,s=i.getRoot(),r=(s.getValueByString(Ct).isNull()||(n._fadeTimeSeconds=s.getValueByString(Ct).toFloat(.5),n._fadeTimeSeconds<0&&(n._fadeTimeSeconds=.5)),s.getValueByString("Groups")),a=r.getSize();for(let t=0;t<a;++t){let s=r.getValueByIndex(t),e=s.getSize(),a=0;for(let i=0;i<e;++i){let t=s.getValueByIndex(i),r=new vt,e=$.getIdManager().getId(t.getValueByString("Id").getRawString());if(r.partId=e,!t.getValueByString(xt).isNull()){let s=t.getValueByString(xt),e=s.getSize();for(let i=0;i<e;++i){let e=new vt,t=$.getIdManager().getId(s.getValueByIndex(i).getString());e.partId=t,r.link.pushBack(e)}}n._partGroups.pushBack(r.clone()),++a}n._partGroupCounts.pushBack(a)}return L.delete(i),n}static delete(e){}updateParameters(t,i){t!=this._lastModel&&this.reset(t),this._lastModel=t,i<0&&(i=0);let s=0;for(let e=0;e<this._partGroupCounts.getSize();e++){var r=this._partGroupCounts.at(e);this.doFade(t,i,s,r),s+=r}this.copyPartOpacities(t)}reset(i){let s=0;for(let e=0;e<this._partGroupCounts.getSize();++e){var r=this._partGroupCounts.at(e);for(let t=s;t<s+r;++t){this._partGroups.at(t).initialize(i);var a=this._partGroups.at(t).partIndex,n=this._partGroups.at(t).parameterIndex;if(!(a<0)){i.setPartOpacityByIndex(a,t==s?1:0),i.setParameterValueByIndex(n,t==s?1:0);for(let e=0;e<this._partGroups.at(t).link.getSize();++e)this._partGroups.at(t).link.at(e).initialize(i)}}s+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){var i=this._partGroups.at(e);if(0!=i.link.getSize()){var s=this._partGroups.at(e).partIndex,r=t.getPartOpacityByIndex(s);for(let e=0;e<i.link.getSize();++e){var a=i.link.at(e).partIndex;a<0||t.setPartOpacityByIndex(a,r)}}}}doFade(s,r,t,a){let n=-1,o=1;for(let i=t;i<t+a;++i){let e=this._partGroups.at(i).partIndex,t=this._partGroups.at(i).parameterIndex;if(.001<s.getParameterValueByIndex(t)){if(0<=n)break;(n=i,0==this._fadeTimeSeconds)?o=1:(o=s.getPartOpacityByIndex(e),1<(o+=r/this._fadeTimeSeconds)&&(o=1))}}n<0&&(n=0,o=1);for(let e=t;e<t+a;++e){let i=this._partGroups.at(e).partIndex;if(n==e)s.setPartOpacityByIndex(i,o);else{let e,t=s.getPartOpacityByIndex(i);.15<(1-(e=o<.5?-.5*o/.5+1:.5*(1-o)/.5))*(1-o)&&(e=1-.15/(1-o)),t>e&&(t=e),s.setPartOpacityByIndex(i,t)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new e,this._partGroupCounts=new e}}class vt{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new e,null!=t){this.partId=t.partId;for(let e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(e){this.partId=e.partId;for(var t=e.link.begin();t.notEqual(e.link.end());t.preIncrement())this.link.pushBack(t.ptr().clone());return this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){var t=new vt;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new e;for(var i=this.link.begin();i.notEqual(this.link.end());i.increment())t.link.pushBack(i.ptr().clone());return t}}(e=>{e.CubismPose=Mt,e.PartData=vt})(bt=bt||{});class Ft extends c{constructor(e,t){super(),this._width=void 0!==e?e:0,this._height=void 0!==t?t:0,this.setHeight(2)}setWidth(e){e/=this._width;this.scale(e,e)}setHeight(e){e/=this._height;this.scale(e,e)}setPosition(e,t){this.translate(e,t)}setCenterPosition(e,t){this.centerX(e),this.centerY(t)}top(e){this.setY(e)}bottom(e){var t=this._height*this.getScaleY();this.translateY(e-t)}left(e){this.setX(e)}right(e){var t=this._width*this.getScaleX();this.translateX(e-t)}centerX(e){var t=this._width*this.getScaleX();this.translateX(e-t/2)}setX(e){this.translateX(e)}centerY(e){var t=this._height*this.getScaleY();this.translateY(e-t/2)}setY(e){this.translateY(e)}setupFromLayout(e){for(var i=e.begin();i.notEqual(e.end());i.preIncrement()){let e=i.ptr().first,t=i.ptr().second;"width"==e?this.setWidth(t):"height"==e&&this.setHeight(t)}for(var s=e.begin();s.notEqual(e.end());s.preIncrement()){let e=s.ptr().first,t=s.ptr().second;"x"==e?this.setX(t):"y"==e?this.setY(t):"center_x"==e?this.centerX(t):"center_y"==e?this.centerY(t):"top"==e?this.top(t):"bottom"==e?this.bottom(t):"left"==e?this.left(t):"right"==e&&this.right(t)}}}(Pt=Pt||{}).CubismModelMatrix=Ft;class It{constructor(e,t){this.x=e,this.y=t,this.x=null==e?0:e,this.y=null==t?0:t}add(e){var t=new It(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){var t=new It(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){var t=new It(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new It(e,e))}division(e){var t=new It(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new It(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){var e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}}(Bt=Bt||{}).CubismVector2=It;class Vt{static range(e,t,i){return e<t?e=t:i<e&&(e=i),e}static sin(e){return Math.sin(e)}static cos(e){return Math.cos(e)}static abs(e){return Math.abs(e)}static sqrt(e){return Math.sqrt(e)}static cbrt(e){if(0===e)return e;let t=e;e=t<0;let i;return e&&(t=-t),i=t===1/0?1/0:(i=Math.exp(Math.log(t)/3),(t/(i*i)+2*i)/3),e?-i:i}static getEasingSine(e){return e<0?0:1<e?1:.5-.5*this.cos(e*Math.PI)}static max(e,t){return t<e?e:t}static min(e,t){return t<e?t:e}static clamp(e,t,i){return e<t?t:i<e?i:e}static degreesToRadian(e){return e/180*Math.PI}static radianToDegrees(e){return 180*e/Math.PI}static directionToRadian(e,t){let i=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(e,t){var i=this.directionToRadian(e,t);let s=this.radianToDegrees(i);return s=0<t.x-e.x?-s:s}static radianToDirection(e){var t=new It;return t.x=this.sin(e),t.y=this.cos(e),t}static quadraticEquation(e,t,i){return this.abs(e)<Vt.Epsilon?this.abs(t)<Vt.Epsilon?-i:-i/t:-(t+this.sqrt(t*t-4*e*i))/(2*e)}static cardanoAlgorithmForBezier(e,t,i,s){if(this.abs(e)<Vt.Epsilon)return this.range(this.quadraticEquation(t,i,s),0,1);let u=t/e,r=i/e,g=(3*r-u*u)/3,a=g/3,d=(2*u*u*u-9*u*r+s/e*27)/27,n=d/2,o=n*n+a*a*a;if(o<0){let e=-g/3,t=e*e*e,i=this.sqrt(t),s=-d/(2*i),r=this.range(s,-1,1),a=Math.acos(r),n=2*this.cbrt(i),o=n*this.cos(a/3)-u/3;if(this.abs(o-.5)<.51)return this.range(o,0,1);let l=n*this.cos((a+2*Math.PI)/3)-u/3;if(this.abs(l-.5)<.51)return this.range(l,0,1);let h=n*this.cos((a+4*Math.PI)/3)-u/3;return this.range(h,0,1)}if(0==o){s=n<0?this.cbrt(-n):-this.cbrt(n);let e=2*s-u/3;if(this.abs(e-.5)<.51)return this.range(e,0,1);let t=-s-u/3;return this.range(t,0,1)}let l=this.sqrt(o),h=this.cbrt(l-n)-this.cbrt(l+n)-u/3;return this.range(h,0,1)}static mod(e,t){var i;return!isFinite(e)||0===t||isNaN(e)||isNaN(t)?(console.warn(`divided: ${e}, divisor: ${t} mod() returns 'NaN'.`),NaN):(i=Math.abs(e),t=Math.abs(t),(i-Math.floor(i/t)*t)*Math.sign(e))}constructor(){}}Vt.Epsilon=1e-5,(wt=wt||{}).CubismMath=Vt;class Et{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(i){this._userTimeSeconds+=i;let s=4/30;if(0==this._lastTimeSeconds)this._lastTimeSeconds=this._userTimeSeconds;else{var i=30*(this._userTimeSeconds-this._lastTimeSeconds),r=(this._lastTimeSeconds=this._userTimeSeconds,i*s/4.5),i=this._faceTargetX-this._faceX,a=this._faceTargetY-this._faceY;if(!(Vt.abs(i)<=.01&&Vt.abs(a)<=.01)){var n=Vt.sqrt(i*i+a*a),a=s*a/n;let e=s*i/n-this._faceVX,t=a-this._faceVY;i=Vt.sqrt(e*e+t*t);(i<-r||r<i)&&(e*=r/i,t*=r/i),this._faceVX+=e,this._faceVY+=t;{let e=.5*(Vt.sqrt(r*r+16*r*n-8*r*n)-r),t=Vt.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);t>e&&(this._faceVX*=e/t,this._faceVY*=e/t)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}}}getX(){return this._faceX}getY(){return this._faceY}set(e,t){this._faceTargetX=e,this._faceTargetY=t}}(Rt=Rt||{}).CubismTargetPoint=Et;class Lt{static delete(e){e.release()}constructor(){this.setBeganMotionHandler=e=>this._onBeganMotion=e,this.getBeganMotionHandler=()=>this._onBeganMotion,this.setFinishedMotionHandler=e=>this._onFinishedMotion=e,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._isLoop=!1,this._isLoopFadeIn=!0,this._previousLoopState=this._isLoop,this._firedEventValues=new e}release(){this._weight=0}updateParameters(e,t,i){var s;t.isAvailable()&&!t.isFinished()&&(this.setupMotionQueueEntry(t,i),s=this.updateFadeWeight(t,i),this.doUpdateParameters(e,i,s,t),0<t.getEndTime())&&t.getEndTime()<i&&t.setIsFinished(!0)}setupMotionQueueEntry(e,t){null==e||e.isStarted()||e.isAvailable()&&(e.setIsStarted(!0),e.setStartTime(t-this._offsetSeconds),e.setFadeInStartTime(t),e.getEndTime()<0&&this.adjustEndTime(e),e._motion._onBeganMotion)&&e._motion._onBeganMotion(e._motion)}updateFadeWeight(e,t){null==e&&P.print(K.LogLevel_Error,"motionQueueEntry is null.");var i=this._weight*(0==this._fadeInSeconds?1:Vt.getEasingSine((t-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:Vt.getEasingSine((e.getEndTime()-t)/this._fadeOutSeconds));return e.setState(t,i),C(0<=i&&i<=1),i}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(e){this._offsetSeconds=e}setLoop(e){this._isLoop=e}getLoop(){return this._isLoop}setLoopFadeIn(e){this._isLoopFadeIn=e}getLoopFadeIn(){return this._isLoopFadeIn}getFiredEvent(e,t){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(e){return null}getModelOpacityValue(){return 1}adjustEndTime(e){var t=this.getDuration(),t=t<=0?-1:e.getStartTime()+t;e.setEndTime(t)}}(Tt=Tt||{}).ACubismMotion=Lt;let Dt="Parameters",At="Blend";class Ot extends Lt{static create(e,t){var i=new Ot;return i.parse(e,t),i}doUpdateParameters(i,e,s,t){for(let t=0;t<this._parameters.getSize();++t){let e=this._parameters.at(t);switch(e.blendType){case kt.Additive:i.addParameterValueById(e.parameterId,e.value,s);break;case kt.Multiply:i.multiplyParameterValueById(e.parameterId,e.value,s);break;case kt.Overwrite:i.setParameterValueById(e.parameterId,e.value,s)}}}calculateExpressionParameters(t,e,i,s,a,n){if(null!=i&&null!=s&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,e);for(let e=0;e<s.getSize();++e){let r=s.at(e);if(null!=r.parameterId){var o=r.overwriteValue=t.getParameterValueById(r.parameterId),l=this.getExpressionParameters();let s=-1;for(let e=0;e<l.getSize();++e)if(r.parameterId==l.at(e).parameterId){s=e;break}if(s<0)0==a?(r.additiveValue=Ot.DefaultAdditiveValue,r.multiplyValue=Ot.DefaultMultiplyValue,r.overwriteValue=o):(r.additiveValue=this.calculateValue(r.additiveValue,Ot.DefaultAdditiveValue,n),r.multiplyValue=this.calculateValue(r.multiplyValue,Ot.DefaultMultiplyValue,n),r.overwriteValue=this.calculateValue(r.overwriteValue,o,n));else{var h=l.at(s).value;let e,t,i;switch(l.at(s).blendType){case kt.Additive:e=h,t=Ot.DefaultMultiplyValue,i=o;break;case kt.Multiply:e=Ot.DefaultAdditiveValue,t=h,i=o;break;case kt.Overwrite:e=Ot.DefaultAdditiveValue,t=Ot.DefaultMultiplyValue,i=h;break;default:return}0==a?(r.additiveValue=e,r.multiplyValue=t,r.overwriteValue=i):(r.additiveValue=r.additiveValue*(1-n)+e*n,r.multiplyValue=r.multiplyValue*(1-n)+t*n,r.overwriteValue=r.overwriteValue*(1-n)+i*n)}}}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(e,t){let i=L.create(e,t);if(i){var r=i.getRoot();this.setFadeInTime(r.getValueByString("FadeInTime").toFloat(1)),this.setFadeOutTime(r.getValueByString("FadeOutTime").toFloat(1));let e=r.getValueByString(Dt).getSize();this._parameters.prepareCapacity(e);for(let s=0;s<e;++s){let e=r.getValueByString(Dt).getValueByIndex(s),t=$.getIdManager().getId(e.getValueByString("Id").getRawString()),i=e.getValueByString("Value").toFloat();var a=e.getValueByString(At).isNull()||"Add"==e.getValueByString(At).getString()?kt.Additive:"Multiply"==e.getValueByString(At).getString()?kt.Multiply:"Overwrite"==e.getValueByString(At).getString()?kt.Overwrite:kt.Additive,n=new Ut;n.parameterId=t,n.blendType=a,n.value=i,this._parameters.pushBack(n)}L.delete(i)}}calculateValue(e,t,i){return e*(1-i)+t*i}constructor(){super(),this._parameters=new e,this._fadeWeight=0}}Ot.DefaultAdditiveValue=0,Ot.DefaultMultiplyValue=1,(e=>{e[e.Additive=0]="Additive",e[e.Multiply=1]="Multiply",e[e.Overwrite=2]="Overwrite"})(kt=kt||{});class Ut{}(e=>{e.CubismExpressionMotion=Ot,e.ExpressionBlendType=kt,e.ExpressionParameter=Ut})(Nt=Nt||{});class Gt{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,(this._motionQueueEntryHandle=this)._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Lt.delete(this._motion)}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){t+=e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||t<this._endTimeSeconds)&&(this._endTimeSeconds=t)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}(zt=zt||{}).CubismMotionQueueEntry=Gt;class Xt{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new e}release(){for(let e=0;e<this._motions.getSize();++e)this._motions.at(e)&&(this._motions.at(e).release(),this._motions.set(e,null));this._motions=null}startMotion(e,t,i){if(null==e)return Yt;let s=null;for(let e=0;e<this._motions.getSize();++e)null!=(s=this._motions.at(e))&&s.setFadeOut(s._motion.getFadeOutTime());return(s=new Gt)._autoDelete=t,s._motion=e,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e)t=this._motions.erase(t);else if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=null,t=this._motions.erase(t)}return!0}isFinishedByHandle(e){for(var t=this._motions.begin();t.notEqual(this._motions.end());t.increment()){var i=t.ptr();if(null!=i&&i._motionQueueEntryHandle==e&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();t=(null!=e&&(e.release(),e=null),this._motions.erase(t))}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(e){for(var t=this._motions.begin();t.notEqual(this._motions.end());t.preIncrement()){var i=t.ptr();if(null!=i&&i._motionQueueEntryHandle==e)return i}return null}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(i,s){let r=!1;for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e)t=this._motions.erase(t);else{var a=e._motion;if(null==a)e.release(),e=null,t=this._motions.erase(t);else{a.updateParameters(i,e,s),r=!0;var n=a.getFiredEvent(e.getLastCheckEventSeconds()-e.getStartTime(),s-e.getStartTime());for(let e=0;e<n.getSize();++e)this._eventCallBack(this,n.at(e),this._eventCustomData);e.setLastCheckEventSeconds(s),e.isFinished()?(e.release(),e=null,t=this._motions.erase(t)):(e.isTriggeredFadeOut()&&e.startFadeOut(e.getFadeOutSeconds(),s),t.preIncrement())}}}return r}}let Yt=-1;(e=>{e.CubismMotionQueueManager=Xt,e.InvalidMotionQueueEntryHandleValue=Yt})(jt=jt||{});class $t{}class Zt extends Xt{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new e,this._fadeWeights=new e}release(){this._expressionParameterValues&&(J(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(J(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return M("CubismExpressionMotionManager.getCurrentPriority() is deprecated because a priority value is not actually used during expression motion playback."),this._currentPriority}getReservePriority(){return M("CubismExpressionMotionManager.getReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority}getFadeWeight(e){return e<0||this._fadeWeights.getSize()<1||e>=this._fadeWeights.getSize()?(console.warn("Failed to get the fade weight value. The element at that index does not exist."),-1):this._fadeWeights.at(e)}setFadeWeight(e,t){e<0||this._fadeWeights.getSize()<1||this._fadeWeights.getSize()<=e?console.warn("Failed to set the fade weight value. The element at that index does not exist."):this._fadeWeights.set(e,t)}setReservePriority(e){M("CubismExpressionMotionManager.setReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority=e}startMotionPriority(e,t,i){return M("CubismExpressionMotionManager.startMotionPriority() is deprecated because a priority value is not actually used during expression motion playback."),i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this.startMotion(e,t)}updateMotion(s,e){this._userTimeSeconds+=e;let t=!1,i=this.getCubismMotionQueueEntries(),r=0,a=0;if(this._fadeWeights.getSize()!==i.getSize()){let t=i.getSize()-this._fadeWeights.getSize();for(let e=0;e<t;e++)this._fadeWeights.pushBack(0)}for(let e=this._motions.begin();e.notEqual(this._motions.end());){var n=e.ptr();if(null==n)e=i.erase(e);else{var o=n.getCubismMotion();if(null==o)J(n),e=i.erase(e);else{var l=o.getExpressionParameters();if(n.isAvailable())for(let i=0;i<l.getSize();++i)if(null!=l.at(i).parameterId){let t=-1;for(let e=0;e<this._expressionParameterValues.getSize();++e)if(this._expressionParameterValues.at(e).parameterId==l.at(i).parameterId){t=e;break}if(!(0<=t)){let e=new $t;e.parameterId=l.at(i).parameterId,e.additiveValue=Ot.DefaultAdditiveValue,e.multiplyValue=Ot.DefaultMultiplyValue,e.overwriteValue=s.getParameterValueById(e.parameterId),this._expressionParameterValues.pushBack(e)}}o.setupMotionQueueEntry(n,this._userTimeSeconds),this.setFadeWeight(a,o.updateFadeWeight(n,this._userTimeSeconds)),o.calculateExpressionParameters(s,this._userTimeSeconds,n,this._expressionParameterValues,a,this.getFadeWeight(a)),r+=0==o.getFadeInTime()?1:Vt.getEasingSine((this._userTimeSeconds-n.getFadeInStartTime())/o.getFadeInTime()),t=!0,n.isTriggeredFadeOut()&&n.startFadeOut(n.getFadeOutSeconds(),this._userTimeSeconds),e.preIncrement(),++a}}}if(1<i.getSize()&&1<=this.getFadeWeight(this._fadeWeights.getSize()-1))for(let e=i.getSize()-2;0<=e;--e)J(i.at(e)),i.remove(e),this._fadeWeights.remove(e);1<r&&(r=1);for(let t=0;t<this._expressionParameterValues.getSize();++t){let e=this._expressionParameterValues.at(t);s.setParameterValueById(e.parameterId,(e.overwriteValue+e.additiveValue)*e.multiplyValue,r),e.additiveValue=Ot.DefaultAdditiveValue,e.multiplyValue=Ot.DefaultMultiplyValue}return t}}(Ht=Ht||{}).CubismExpressionMotionManager=Zt,(e=>{e[e.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",e[e.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",e[e.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity"})(qt=qt||{}),(e=>{e[e.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",e[e.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",e[e.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",e[e.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped"})(Wt=Wt||{});class Kt{constructor(){this.time=0,this.value=0}}class Qt{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class te{constructor(){this.type=qt.CubismMotionCurveTarget_Model,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class ee{constructor(){this.fireTime=0}}class ie{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new e,this.segments=new e,this.points=new e,this.events=new e}}(e=>{e.CubismMotionCurve=te,e.CubismMotionCurveTarget=qt,e.CubismMotionData=ie,e.CubismMotionEvent=ee,e.CubismMotionPoint=Kt,e.CubismMotionSegment=Qt,e.CubismMotionSegmentType=Wt})(Jt=Jt||{});let se="Meta",re="Curves",ae="FadeInTime",ne="FadeOutTime",oe="Segments",le="UserData";class he{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(se).getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(se).getValueByString("Loop").toBoolean()}hasConsistency(){let e=!0;if(!this._json||!this._json.getRoot())return!1;var i=this._json.getRoot().getValueByString(re).getVector().getSize();let s=0,r=0;for(let t=0;t<i;++t)for(let e=0;e<this.getMotionCurveSegmentCount(t);){switch(0==e&&(r+=1,e+=2),this.getMotionCurveSegment(t,e)){case Wt.CubismMotionSegmentType_Linear:r+=1,e+=3;break;case Wt.CubismMotionSegmentType_Bezier:r+=3,e+=7;break;case Wt.CubismMotionSegmentType_Stepped:case Wt.CubismMotionSegmentType_InverseStepped:r+=1,e+=3;break;default:C(0)}++s}return i!=this.getMotionCurveCount()&&(v("The number of curves does not match the metadata."),e=!1),s!=this.getMotionTotalSegmentCount()&&(v("The number of segment does not match the metadata."),e=!1),r!=this.getMotionTotalPointCount()&&(v("The number of point does not match the metadata."),e=!1),e}getEvaluationOptionFlag(e){return ue.EvaluationOptionFlag_AreBeziersRistricted==e&&this._json.getRoot().getValueByString(se).getValueByString("AreBeziersRestricted").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString(se).getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString(se).getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(se).getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(se).getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(se).getValueByString(ae).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(se).getValueByString(ne).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(se).getValueByString(ae).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(se).getValueByString(ne).toFloat()}getMotionCurveTarget(e){return this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString("Target").getRawString()}getMotionCurveId(e){return $.getIdManager().getId(this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(e){return!this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(ae).isNull()}isExistMotionCurveFadeOutTime(e){return!this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(ne).isNull()}getMotionCurveFadeInTime(e){return this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(ae).toFloat()}getMotionCurveFadeOutTime(e){return this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(ne).toFloat()}getMotionCurveSegmentCount(e){return this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(oe).getVector().getSize()}getMotionCurveSegment(e,t){return this._json.getRoot().getValueByString(re).getValueByIndex(e).getValueByString(oe).getValueByIndex(t).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(se).getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(se).getValueByString("TotalUserDataSize").toInt()}getEventTime(e){return this._json.getRoot().getValueByString(le).getValueByIndex(e).getValueByString("Time").toFloat()}getEventValue(e){return new g(this._json.getRoot().getValueByString(le).getValueByIndex(e).getValueByString("Value").getRawString())}}(e=>{e[e.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted"})(ue=ue||{}),(ge=ge||{}).CubismMotionJson=he;let de="Opacity";function _e(e,t,i){var s=new Kt;return s.time=e.time+(t.time-e.time)*i,s.value=e.value+(t.value-e.value)*i,s}function ce(e,t){let i=(t-e[0].time)/(e[1].time-e[0].time);return i<0&&(i=0),e[0].value+(e[1].value-e[0].value)*i}function me(e,t){let i=(t-e[0].time)/(e[3].time-e[0].time);i<0&&(i=0);var t=_e(e[0],e[1],i),s=_e(e[1],e[2],i),e=_e(e[2],e[3],i),t=_e(t,s,i),s=_e(s,e,i);return _e(t,s,i).value}function pe(e,t){var i=e[0].time,s=e[3].time,r=e[1].time,a=e[2].time,s=s-3*a+3*r-i,a=3*a-6*r+3*i,r=3*r-3*i,i=i-t,t=Vt.cardanoAlgorithmForBezier(s,a,r,i),s=_e(e[0],e[1],t),a=_e(e[1],e[2],t),r=_e(e[2],e[3],t),i=_e(s,a,t),e=_e(a,r,t);return _e(i,e,t).value}function fe(e,t){return e[0].value}function ye(e,t){return e[1].value}function Se(t,i,s,r,a){i=t.curves.at(i);let n=-1;var o=i.baseSegmentIndex+i.segmentCount;let l=0;for(let e=i.baseSegmentIndex;e<o;++e)if(l=t.segments.at(e).basePointIndex+(t.segments.at(e).segmentType==Wt.CubismMotionSegmentType_Bezier?3:1),t.points.at(l).time>s){n=e;break}{if(-1!=n)return(h=t.segments.at(n)).evaluate(t.points.get(h.basePointIndex),s);if(!(r&&s<a))return t.points.at(l).value;var e=o-1,h=(i=(r=t).segments.at(i.baseSegmentIndex).basePointIndex,l),u=s,g=[new Kt,new Kt];{let e=r.points.at(h);g[0].time=e.time,g[0].value=e.value}{let e=r.points.at(i);g[1].time=a,g[1].value=e.value}switch(r.segments.at(e).segmentType){case Wt.CubismMotionSegmentType_Linear:case Wt.CubismMotionSegmentType_Bezier:default:return ce(g,u);case Wt.CubismMotionSegmentType_Stepped:return fe(g);case Wt.CubismMotionSegmentType_InverseStepped:return ye(g)}}}(e=>{e[e.MotionBehavior_V1=0]="MotionBehavior_V1",e[e.MotionBehavior_V2=1]="MotionBehavior_V2"})(Ce=Ce||{});class Be extends Lt{static create(e,t,i,s,r=!1){var a=new Be;return a.parse(e,t,r),a._motionData?(a._sourceFrameRate=a._motionData.fps,a._loopDurationSeconds=a._motionData.duration,a._onFinishedMotion=i,a._onBeganMotion=s,a):(J(a),null)}doUpdateParameters(s,i,r,a){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=$.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=$.getIdManager().getId("LipSync")),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=$.getIdManager().getId(de)),this._motionBehavior===Ce.MotionBehavior_V2&&this._previousLoopState!==this._isLoop&&(this.adjustEndTime(a),this._previousLoopState=this._isLoop);let e=i-a.getStartTime(),n=(e<0&&(e=0),Number.MAX_VALUE),o=Number.MAX_VALUE;let l=0,h=0;64<this._eyeBlinkParameterIds.getSize()&&x("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),64<this._lipSyncParameterIds.getSize()&&x("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());var u=this._fadeInSeconds<=0?1:Vt.getEasingSine((i-a.getFadeInStartTime())/this._fadeInSeconds),g=this._fadeOutSeconds<=0||a.getEndTime()<0?1:Vt.getEasingSine((a.getEndTime()-i)/this._fadeOutSeconds);let d,_,m,c=e,p=this._motionData.duration;var f=this._motionBehavior===Ce.MotionBehavior_V2&&this._isLoop;if(this._isLoop)for(this._motionBehavior===Ce.MotionBehavior_V2&&(p+=1/this._motionData.fps);c>p;)c-=p;var y,S,v=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&v.at(_).type==qt.CubismMotionCurveTarget_Model;++_)d=Se(this._motionData,_,c,f,p),v.at(_).id==this._modelCurveIdEyeBlink?o=d:v.at(_).id==this._modelCurveIdLipSync?n=d:v.at(_).id==this._modelCurveIdOpacity&&(this._modelOpacity=d,s.setModelOapcity(this.getModelOpacityValue()));for(;_<this._motionData.curveCount&&v.at(_).type==qt.CubismMotionCurveTarget_Parameter;++_)if(-1!=(m=s.getParameterIndex(v.at(_).id))){let e=s.getParameterValueByIndex(m);if(d=Se(this._motionData,_,c,f,p),o!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.getSize()&&e<64;++e)if(this._eyeBlinkParameterIds.at(e)==v.at(_).id){d*=o,h|=1<<e;break}if(n!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.getSize()&&e<64;++e)if(this._lipSyncParameterIds.at(e)==v.at(_).id){d+=n,l|=1<<e;break}let t;s.isRepeat(m)&&(d=s.getParameterRepeatValue(m,d)),t=v.at(_).fadeInTime<0&&v.at(_).fadeOutTime<0?e+(d-e)*r:(y=v.at(_).fadeInTime<0?u:0==v.at(_).fadeInTime?1:Vt.getEasingSine((i-a.getFadeInStartTime())/v.at(_).fadeInTime),S=v.at(_).fadeOutTime<0?g:0==v.at(_).fadeOutTime||a.getEndTime()<0?1:Vt.getEasingSine((a.getEndTime()-i)/v.at(_).fadeOutTime),e+(d-e)*(this._weight*y*S)),s.setParameterValueByIndex(m,t,1)}if(o!=Number.MAX_VALUE)for(let i=0;i<this._eyeBlinkParameterIds.getSize()&&i<64;++i){let t=s.getParameterValueById(this._eyeBlinkParameterIds.at(i));if(!(h>>i&1)){let e=t+(o-t)*r;s.setParameterValueById(this._eyeBlinkParameterIds.at(i),e)}}if(n!=Number.MAX_VALUE)for(let i=0;i<this._lipSyncParameterIds.getSize()&&i<64;++i){let t=s.getParameterValueById(this._lipSyncParameterIds.at(i));if(!(l>>i&1)){let e=t+(n-t)*r;s.setParameterValueById(this._lipSyncParameterIds.at(i),e)}}for(;_<this._motionData.curveCount&&v.at(_).type==qt.CubismMotionCurveTarget_PartOpacity;++_)-1!=(m=s.getParameterIndex(v.at(_).id))&&(d=Se(this._motionData,_,c,f,p),s.setParameterValueByIndex(m,d));e>=p&&(this._isLoop?this.updateForNextLoop(a,i,c):(this._onFinishedMotion&&this._onFinishedMotion(this),a.setIsFinished(!0))),this._lastWeight=r}setIsLoop(e){v("setIsLoop() is a deprecated function. Please use setLoop()."),this._isLoop=e}isLoop(){return v("isLoop() is a deprecated function. Please use getLoop()."),this._isLoop}setIsLoopFadeIn(e){v("setIsLoopFadeIn() is a deprecated function. Please use setLoopFadeIn()."),this._isLoopFadeIn=e}isLoopFadeIn(){return v("isLoopFadeIn() is a deprecated function. Please use getLoopFadeIn()."),this._isLoopFadeIn}setMotionBehavior(e){this._motionBehavior=e}getMotionBehavior(){return this._motionBehavior}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,i){var s=this._motionData.curves;for(let e=0;e<this._motionData.curveCount;++e)if(t==s.at(e).id)return void(s.at(e).fadeInTime=i)}setParameterFadeOutTime(t,i){var s=this._motionData.curves;for(let e=0;e<this._motionData.curveCount;++e)if(t==s.at(e).id)return void(s.at(e).fadeOutTime=i)}getParameterFadeInTime(t){var i=this._motionData.curves;for(let e=0;e<this._motionData.curveCount;++e)if(t==i.at(e).id)return i.at(e).fadeInTime;return-1}getParameterFadeOutTime(t){var i=this._motionData.curves;for(let e=0;e<this._motionData.curveCount;++e)if(t==i.at(e).id)return i.at(e).fadeOutTime;return-1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}constructor(){super(),this._motionBehavior=Ce.MotionBehavior_V2,this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1,this._debugMode=!1}release(){this._motionData=void 0,this._motionData=null}updateForNextLoop(e,t,i){switch(this._motionBehavior){case Ce.MotionBehavior_V2:default:e.setStartTime(t-i),this._isLoopFadeIn&&e.setFadeInStartTime(t-i),null!=this._onFinishedMotion&&this._onFinishedMotion(this);break;case Ce.MotionBehavior_V1:e.setStartTime(t),this._isLoopFadeIn&&e.setFadeInStartTime(t)}}parse(e,t,i=!1){let r=new he(e,t);if(r)if(i&&!r.hasConsistency())r.release(),b("Inconsistent motion3.json.");else{this._motionData=new ie,this._motionData.duration=r.getMotionDuration(),this._motionData.loop=r.isMotionLoop(),this._motionData.curveCount=r.getMotionCurveCount(),this._motionData.fps=r.getMotionFps(),this._motionData.eventCount=r.getEventCount();var a=r.getEvaluationOptionFlag(ue.EvaluationOptionFlag_AreBeziersRistricted);r.isExistMotionFadeInTime()?this._fadeInSeconds=r.getMotionFadeInTime()<0?1:r.getMotionFadeInTime():this._fadeInSeconds=1,r.isExistMotionFadeOutTime()?this._fadeOutSeconds=r.getMotionFadeOutTime()<0?1:r.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,te,!0),this._motionData.segments.updateSize(r.getMotionTotalSegmentCount(),Qt,!0),this._motionData.points.updateSize(r.getMotionTotalPointCount(),Kt,!0),this._motionData.events.updateSize(this._motionData.eventCount,ee,!0);let i=0,s=0;for(let t=0;t<this._motionData.curveCount;++t){"Model"==r.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=qt.CubismMotionCurveTarget_Model:"Parameter"==r.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=qt.CubismMotionCurveTarget_Parameter:"PartOpacity"==r.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=qt.CubismMotionCurveTarget_PartOpacity:v('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(t).id=r.getMotionCurveId(t),this._motionData.curves.at(t).baseSegmentIndex=s,this._motionData.curves.at(t).fadeInTime=r.isExistMotionCurveFadeInTime(t)?r.getMotionCurveFadeInTime(t):-1,this._motionData.curves.at(t).fadeOutTime=r.isExistMotionCurveFadeOutTime(t)?r.getMotionCurveFadeOutTime(t):-1;for(let e=0;e<r.getMotionCurveSegmentCount(t);){switch(0==e?(this._motionData.segments.at(s).basePointIndex=i,this._motionData.points.at(i).time=r.getMotionCurveSegment(t,e),this._motionData.points.at(i).value=r.getMotionCurveSegment(t,e+1),i+=1,e+=2):this._motionData.segments.at(s).basePointIndex=i-1,r.getMotionCurveSegment(t,e)){case Wt.CubismMotionSegmentType_Linear:this._motionData.segments.at(s).segmentType=Wt.CubismMotionSegmentType_Linear,this._motionData.segments.at(s).evaluate=ce,this._motionData.points.at(i).time=r.getMotionCurveSegment(t,e+1),this._motionData.points.at(i).value=r.getMotionCurveSegment(t,e+2),i+=1,e+=3;break;case Wt.CubismMotionSegmentType_Bezier:this._motionData.segments.at(s).segmentType=Wt.CubismMotionSegmentType_Bezier,this._motionData.segments.at(s).evaluate=a?me:pe,this._motionData.points.at(i).time=r.getMotionCurveSegment(t,e+1),this._motionData.points.at(i).value=r.getMotionCurveSegment(t,e+2),this._motionData.points.at(i+1).time=r.getMotionCurveSegment(t,e+3),this._motionData.points.at(i+1).value=r.getMotionCurveSegment(t,e+4),this._motionData.points.at(i+2).time=r.getMotionCurveSegment(t,e+5),this._motionData.points.at(i+2).value=r.getMotionCurveSegment(t,e+6),i+=3,e+=7;break;case Wt.CubismMotionSegmentType_Stepped:this._motionData.segments.at(s).segmentType=Wt.CubismMotionSegmentType_Stepped,this._motionData.segments.at(s).evaluate=fe,this._motionData.points.at(i).time=r.getMotionCurveSegment(t,e+1),this._motionData.points.at(i).value=r.getMotionCurveSegment(t,e+2),i+=1,e+=3;break;case Wt.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(s).segmentType=Wt.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(s).evaluate=ye,this._motionData.points.at(i).time=r.getMotionCurveSegment(t,e+1),this._motionData.points.at(i).value=r.getMotionCurveSegment(t,e+2),i+=1,e+=3;break;default:C(0)}++this._motionData.curves.at(t).segmentCount,++s}}for(let e=0;e<r.getEventCount();++e)this._motionData.events.at(e).fireTime=r.getEventTime(e),this._motionData.events.at(e).value=r.getEventValue(e);r.release(),r=void 0,r=null}else r.release(),r=void 0}getFiredEvent(t,i){this._firedEventValues.updateSize(0);for(let e=0;e<this._motionData.eventCount;++e)this._motionData.events.at(e).fireTime>t&&this._motionData.events.at(e).fireTime<=i&&this._firedEventValues.pushBack(new g(this._motionData.events.at(e).value.s));return this._firedEventValues}isExistModelOpacity(){for(let e=0;e<this._motionData.curveCount;e++){var t=this._motionData.curves.at(e);if(t.type==qt.CubismMotionCurveTarget_Model&&0==t.id.getString().s.localeCompare(de))return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let e=0;e<this._motionData.curveCount;e++){var t=this._motionData.curves.at(e);if(t.type==qt.CubismMotionCurveTarget_Model&&0==t.id.getString().s.localeCompare(de))return e}return-1}getModelOpacityId(e){if(-1!=e){e=this._motionData.curves.at(e);if(e.type==qt.CubismMotionCurveTarget_Model&&0==e.id.getString().s.localeCompare(de))return $.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}setDebugMode(e){this._debugMode=e}}(xe=xe||{}).CubismMotion=Be;class we extends Xt{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,t,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(e,t)}updateMotion(e,t){this._userTimeSeconds+=t;t=super.doUpdateMotion(e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),t}reserveMotion(e){return!(e<=this._reservePriority||e<=this._currentPriority||(this._reservePriority=e,0))}}(Me=Me||{}).CubismMotionManager=we,(e=>{e[e.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter"})(ve=ve||{}),(e=>{e[e.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",e[e.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",e[e.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle"})(be=be||{});class Fe{constructor(){this.gravity=new It(0,0),this.wind=new It(0,0)}}class Ie{}class Ve{}class Ee{constructor(){this.initialPosition=new It(0,0),this.position=new It(0,0),this.lastPosition=new It(0,0),this.lastGravity=new It(0,0),this.force=new It(0,0),this.velocity=new It(0,0)}}class Re{constructor(){this.normalizationPosition=new Ve,this.normalizationAngle=new Ve}}class Te{constructor(){this.source=new Ie}}class Le{constructor(){this.destination=new Ie,this.translationScale=new It(0,0)}}class De{constructor(){this.settings=new e,this.inputs=new e,this.outputs=new e,this.particles=new e,this.gravity=new It(0,0),this.wind=new It(0,0),this.fps=0}}(e=>{e.CubismPhysicsInput=Te,e.CubismPhysicsNormalization=Ve,e.CubismPhysicsOutput=Le,e.CubismPhysicsParameter=Ie,e.CubismPhysicsParticle=Ee,e.CubismPhysicsRig=De,e.CubismPhysicsSource=be,e.CubismPhysicsSubRig=Re,e.CubismPhysicsTargetType=ve,e.PhysicsJsonEffectiveForces=Fe})(Pe=Pe||{});let Ae="Position",Oe="Angle",ke="Type",Ne="Meta",ze="EffectiveForces",Ue="Gravity",Ge="Wind",Xe="PhysicsSettings",Ye="Normalization",je="Minimum",He="Maximum",qe="Default",We="Reflect",Je="Weight",$e="Input",Ze="Output",Ke="Vertices";class Qe{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getGravity(){var e=new It(0,0);return e.x=this._json.getRoot().getValueByString(Ne).getValueByString(ze).getValueByString(Ue).getValueByString("X").toFloat(),e.y=this._json.getRoot().getValueByString(Ne).getValueByString(ze).getValueByString(Ue).getValueByString("Y").toFloat(),e}getWind(){var e=new It(0,0);return e.x=this._json.getRoot().getValueByString(Ne).getValueByString(ze).getValueByString(Ge).getValueByString("X").toFloat(),e.y=this._json.getRoot().getValueByString(Ne).getValueByString(ze).getValueByString(Ge).getValueByString("Y").toFloat(),e}getFps(){return this._json.getRoot().getValueByString(Ne).getValueByString("Fps").toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(Ne).getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(Ne).getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(Ne).getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString(Ne).getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Ae).getValueByString(je).toFloat()}getNormalizationPositionMaximumValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Ae).getValueByString(He).toFloat()}getNormalizationPositionDefaultValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Ae).getValueByString(qe).toFloat()}getNormalizationAngleMinimumValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Oe).getValueByString(je).toFloat()}getNormalizationAngleMaximumValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Oe).getValueByString(He).toFloat()}getNormalizationAngleDefaultValue(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ye).getValueByString(Oe).getValueByString(qe).toFloat()}getInputCount(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString($e).getVector().getSize()}getInputWeight(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString($e).getValueByIndex(t).getValueByString(Je).toFloat()}getInputReflect(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString($e).getValueByIndex(t).getValueByString(We).toBoolean()}getInputType(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString($e).getValueByIndex(t).getValueByString(ke).getRawString()}getInputSourceId(e,t){return $.getIdManager().getId(this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString($e).getValueByIndex(t).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getVector().getSize()}getOutputVertexIndex(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString("VertexIndex").toInt()}getOutputAngleScale(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString("Scale").toFloat()}getOutputWeight(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString(Je).toFloat()}getOutputDestinationId(e,t){return $.getIdManager().getId(this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString(ke).getRawString()}getOutputReflect(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ze).getValueByIndex(t).getValueByString(We).toBoolean()}getParticleCount(e){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getVector().getSize()}getParticleMobility(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString("Mobility").toFloat()}getParticleDelay(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString("Delay").toFloat()}getParticleAcceleration(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString("Acceleration").toFloat()}getParticleRadius(e,t){return this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString("Radius").toFloat()}getParticlePosition(e,t){var i=new It(0,0);return i.x=this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString(Ae).getValueByString("X").toFloat(),i.y=this._json.getRoot().getValueByString(Xe).getValueByIndex(e).getValueByString(Ke).getValueByIndex(t).getValueByString(Ae).getValueByString("Y").toFloat(),i}}(ti=ti||{}).CubismPhysicsJson=Qe;let ei="Angle";class ii{static create(e,t){var i=new ii;return i.parse(e,t),i._physicsRig.gravity.y=0,i}static delete(e){null!=e&&e.release()}parse(e,t){this._physicsRig=new De;let s=new Qe(e,t),r=(this._physicsRig.gravity=s.getGravity(),this._physicsRig.wind=s.getWind(),this._physicsRig.subRigCount=s.getSubRigCount(),this._physicsRig.fps=s.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Re,!0),this._physicsRig.inputs.updateSize(s.getTotalInputCount(),Te,!0),this._physicsRig.outputs.updateSize(s.getTotalOutputCount(),Le,!0),this._physicsRig.particles.updateSize(s.getVertexCount(),Ee,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear(),0),a=0,n=0;for(let i=0;i<this._physicsRig.settings.getSize();++i){this._physicsRig.settings.at(i).normalizationPosition.minimum=s.getNormalizationPositionMinimumValue(i),this._physicsRig.settings.at(i).normalizationPosition.maximum=s.getNormalizationPositionMaximumValue(i),this._physicsRig.settings.at(i).normalizationPosition.defalut=s.getNormalizationPositionDefaultValue(i),this._physicsRig.settings.at(i).normalizationAngle.minimum=s.getNormalizationAngleMinimumValue(i),this._physicsRig.settings.at(i).normalizationAngle.maximum=s.getNormalizationAngleMaximumValue(i),this._physicsRig.settings.at(i).normalizationAngle.defalut=s.getNormalizationAngleDefaultValue(i),this._physicsRig.settings.at(i).inputCount=s.getInputCount(i),this._physicsRig.settings.at(i).baseInputIndex=r;for(let e=0;e<this._physicsRig.settings.at(i).inputCount;++e)this._physicsRig.inputs.at(r+e).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+e).weight=s.getInputWeight(i,e),this._physicsRig.inputs.at(r+e).reflect=s.getInputReflect(i,e),"X"==s.getInputType(i,e)?(this._physicsRig.inputs.at(r+e).type=be.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=ai):"Y"==s.getInputType(i,e)?(this._physicsRig.inputs.at(r+e).type=be.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=ni):s.getInputType(i,e)==ei&&(this._physicsRig.inputs.at(r+e).type=be.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=oi),this._physicsRig.inputs.at(r+e).source.targetType=ve.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+e).source.id=s.getInputSourceId(i,e);r+=this._physicsRig.settings.at(i).inputCount,this._physicsRig.settings.at(i).outputCount=s.getOutputCount(i),this._physicsRig.settings.at(i).baseOutputIndex=a;let t=new ri;t.outputs.resize(this._physicsRig.settings.at(i).outputCount);var o=new ri;o.outputs.resize(this._physicsRig.settings.at(i).outputCount);for(let e=0;e<this._physicsRig.settings.at(i).outputCount;++e)t.outputs.set(e,0),o.outputs.set(e,0),this._physicsRig.outputs.at(a+e).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+e).vertexIndex=s.getOutputVertexIndex(i,e),this._physicsRig.outputs.at(a+e).angleScale=s.getOutputAngleScale(i,e),this._physicsRig.outputs.at(a+e).weight=s.getOutputWeight(i,e),this._physicsRig.outputs.at(a+e).destination.targetType=ve.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+e).destination.id=s.getOutputDestinationId(i,e),"X"==s.getOutputType(i,e)?(this._physicsRig.outputs.at(a+e).type=be.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+e).getValue=li,this._physicsRig.outputs.at(a+e).getScale=di):"Y"==s.getOutputType(i,e)?(this._physicsRig.outputs.at(a+e).type=be.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+e).getValue=hi,this._physicsRig.outputs.at(a+e).getScale=_i):s.getOutputType(i,e)==ei&&(this._physicsRig.outputs.at(a+e).type=be.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+e).getValue=ui,this._physicsRig.outputs.at(a+e).getScale=ci),this._physicsRig.outputs.at(a+e).reflect=s.getOutputReflect(i,e);this._currentRigOutputs.pushBack(t),this._previousRigOutputs.pushBack(o),a+=this._physicsRig.settings.at(i).outputCount,this._physicsRig.settings.at(i).particleCount=s.getParticleCount(i),this._physicsRig.settings.at(i).baseParticleIndex=n;for(let e=0;e<this._physicsRig.settings.at(i).particleCount;++e)this._physicsRig.particles.at(n+e).mobility=s.getParticleMobility(i,e),this._physicsRig.particles.at(n+e).delay=s.getParticleDelay(i,e),this._physicsRig.particles.at(n+e).acceleration=s.getParticleAcceleration(i,e),this._physicsRig.particles.at(n+e).radius=s.getParticleRadius(i,e),this._physicsRig.particles.at(n+e).position=s.getParticlePosition(i,e);n+=this._physicsRig.settings.at(i).particleCount}this.initialize(),s.release(),s=void 0,s=null}stabilization(i){var e,t;let s,a,n,o;var l,h,u,g,d=new It,_=i.getModel().parameters.values,m=i.getModel().parameters.maximumValues,c=i.getModel().parameters.minimumValues,p=i.getModel().parameters.defaultValues;(null!=(t=null==(t=this._parameterCaches)?void 0:t.length)?t:0)<i.getParameterCount()&&(this._parameterCaches=new Float32Array(i.getParameterCount())),(null!=(t=null==(e=this._parameterInputCaches)?void 0:e.length)?t:0)<i.getParameterCount()&&(this._parameterInputCaches=new Float32Array(i.getParameterCount()));for(let e=0;e<i.getParameterCount();++e)this._parameterCaches[e]=_[e],this._parameterInputCaches[e]=_[e];for(let r=0;r<this._physicsRig.subRigCount;++r){s={angle:0},d.x=0,d.y=0,l=this._physicsRig.settings.at(r),h=this._physicsRig.inputs.get(l.baseInputIndex),u=this._physicsRig.outputs.get(l.baseOutputIndex),g=this._physicsRig.particles.get(l.baseParticleIndex);for(let e=0;e<l.inputCount;++e)a=h[e].weight/100,-1==h[e].sourceParameterIndex&&(h[e].sourceParameterIndex=i.getParameterIndex(h[e].source.id)),h[e].getNormalizedParameterValue(d,s,_[h[e].sourceParameterIndex],c[h[e].sourceParameterIndex],m[h[e].sourceParameterIndex],p[h[e].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,h[e].reflect,a),this._parameterCaches[h[e].sourceParameterIndex]=_[h[e].sourceParameterIndex];n=Vt.degreesToRadian(-s.angle),d.x=d.x*Vt.cos(n)-d.y*Vt.sin(n),d.y=d.x*Vt.sin(n)+d.y*Vt.cos(n),pi(g,l.particleCount,d,s.angle,this._options.wind,.001*l.normalizationPosition.maximum);for(let t=0;t<l.outputCount;++t){let e=u[t].vertexIndex;if(-1==u[t].destinationParameterIndex&&(u[t].destinationParameterIndex=i.getParameterIndex(u[t].destination.id)),!(e<1||e>=l.particleCount)){new It;var f=g[e].position.substract(g[e-1].position);o=u[t].getValue(f,g,e,u[t].reflect,this._options.gravity),this._currentRigOutputs.at(r).outputs.set(t,o),this._previousRigOutputs.at(r).outputs.set(t,o);let i=u[t].destinationParameterIndex,s=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(_.subarray(i))):_.slice(i);fi(s,c[i],m[i],o,u[t]);for(let e=i,t=0;e<this._parameterCaches.length;e++,t++)_[e]=this._parameterCaches[e]=s[t]}}}}evaluate(i,e){var t,s,r;let n,o,l,h;var u=new It;let g,d,_,m;if(!(e<=0)){var c,a=i.getModel().parameters.values,p=i.getModel().parameters.maximumValues,f=i.getModel().parameters.minimumValues,y=i.getModel().parameters.defaultValues;if(this._currentRemainTime+=e,5<this._currentRemainTime&&(this._currentRemainTime=0),(null!=(t=null==(S=this._parameterCaches)?void 0:S.length)?t:0)<i.getParameterCount()&&(this._parameterCaches=new Float32Array(i.getParameterCount())),(null!=(r=null==(s=this._parameterInputCaches)?void 0:s.length)?r:0)<i.getParameterCount()){this._parameterInputCaches=new Float32Array(i.getParameterCount());for(let e=0;e<i.getParameterCount();++e)this._parameterInputCaches[e]=a[e]}for(c=0<this._physicsRig.fps?1/this._physicsRig.fps:e;this._currentRemainTime>=c;){for(let t=0;t<this._physicsRig.subRigCount;++t){g=this._physicsRig.settings.at(t),_=this._physicsRig.outputs.get(g.baseOutputIndex);for(let e=0;e<g.outputCount;++e)this._previousRigOutputs.at(t).outputs.set(e,this._currentRigOutputs.at(t).outputs.at(e))}let t=c/this._currentRemainTime;for(let e=0;e<i.getParameterCount();++e)this._parameterCaches[e]=this._parameterInputCaches[e]*(1-t)+a[e]*t,this._parameterInputCaches[e]=this._parameterCaches[e];for(let a=0;a<this._physicsRig.subRigCount;++a){n={angle:0},u.x=0,u.y=0,g=this._physicsRig.settings.at(a),d=this._physicsRig.inputs.get(g.baseInputIndex),_=this._physicsRig.outputs.get(g.baseOutputIndex),m=this._physicsRig.particles.get(g.baseParticleIndex);for(let e=0;e<g.inputCount;++e)o=d[e].weight/100,-1==d[e].sourceParameterIndex&&(d[e].sourceParameterIndex=i.getParameterIndex(d[e].source.id)),d[e].getNormalizedParameterValue(u,n,this._parameterCaches[d[e].sourceParameterIndex],f[d[e].sourceParameterIndex],p[d[e].sourceParameterIndex],y[d[e].sourceParameterIndex],g.normalizationPosition,g.normalizationAngle,d[e].reflect,o);l=Vt.degreesToRadian(-n.angle),u.x=u.x*Vt.cos(l)-u.y*Vt.sin(l),u.y=u.x*Vt.sin(l)+u.y*Vt.cos(l),mi(m,g.particleCount,u,n.angle,this._options.wind,.001*g.normalizationPosition.maximum,c,5);for(let r=0;r<g.outputCount;++r){let t=_[r].vertexIndex;if(-1==_[r].destinationParameterIndex&&(_[r].destinationParameterIndex=i.getParameterIndex(_[r].destination.id)),!(t<1||t>=g.particleCount)){let e=new It,i=(e.x=m[t].position.x-m[t-1].position.x,e.y=m[t].position.y-m[t-1].position.y,h=_[r].getValue(e,m,t,_[r].reflect,this._options.gravity),this._currentRigOutputs.at(a).outputs.set(r,h),_[r].destinationParameterIndex),s=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(i))):this._parameterCaches.slice(i);fi(s,f[i],p[i],h,_[r]);for(let e=i,t=0;e<this._parameterCaches.length;e++,t++)this._parameterCaches[e]=s[t]}}}this._currentRemainTime-=c}var S=this._currentRemainTime/c;this.interpolate(i,S)}}interpolate(e,r){let a,i;var n=e.getModel().parameters.values,o=e.getModel().parameters.maximumValues,l=e.getModel().parameters.minimumValues;for(let t=0;t<this._physicsRig.subRigCount;++t){i=this._physicsRig.settings.at(t),a=this._physicsRig.outputs.get(i.baseOutputIndex);for(let e=0;e<i.outputCount;++e)if(-1!=a[e].destinationParameterIndex){let i=a[e].destinationParameterIndex,s=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(n.subarray(i))):n.slice(i);fi(s,l[i],o[i],this._previousRigOutputs.at(t).outputs.at(e)*(1-r)+this._currentRigOutputs.at(t).outputs.at(e)*r,a[e]);for(let e=i,t=0;e<n.length;e++,t++)n[e]=s[t]}}}setOptions(e){this._options=e}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new si,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new e,this._previousRigOutputs=new e,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){var t,i,s;for(let e=0;e<this._physicsRig.subRigCount;++e){i=this._physicsRig.settings.at(e),(t=this._physicsRig.particles.get(i.baseParticleIndex))[0].initialPosition=new It(0,0),t[0].lastPosition=new It(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new It(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new It(0,0),t[0].force=new It(0,0);for(let e=1;e<i.particleCount;++e)(s=new It(0,0)).y=t[e].radius,t[e].initialPosition=new It(t[e-1].initialPosition.x+s.x,t[e-1].initialPosition.y+s.y),t[e].position=new It(t[e].initialPosition.x,t[e].initialPosition.y),t[e].lastPosition=new It(t[e].initialPosition.x,t[e].initialPosition.y),t[e].lastGravity=new It(0,-1),t[e].lastGravity.y*=-1,t[e].velocity=new It(0,0),t[e].force=new It(0,0)}}}class si{constructor(){this.gravity=new It(0,0),this.wind=new It(0,0)}}class ri{constructor(){this.outputs=new e(0)}}function ai(e,t,i,s,r,a,n,o,l,h){e.x+=yi(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*h}function ni(e,t,i,s,r,a,n,o,l,h){e.y+=yi(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*h}function oi(e,t,i,s,r,a,n,o,l,h){t.angle+=yi(i,s,r,a,o.minimum,o.maximum,o.defalut,l)*h}function li(e,t,i,s,r){let a=e.x;return s&&(a*=-1),a}function hi(e,t,i,s,r){let a=e.y;return s&&(a*=-1),a}function ui(e,t,i,s,r){let a;return r=2<=i?t[i-1].position.substract(t[i-2].position):r.multiplyByScaler(-1),a=Vt.directionToRadian(r,e),s&&(a*=-1),a}function gi(e,t){return Vt.min(e,t)+(e=e,t=t,i=Vt.max(e,t),e=Vt.min(e,t),Vt.abs(i-e)/2);var i}function di(e,t){return JSON.parse(JSON.stringify(e.x))}function _i(e,t){return JSON.parse(JSON.stringify(e.y))}function ci(e,t){return JSON.parse(JSON.stringify(t))}function mi(t,i,e,s,r,a,n,o){var l,h,u,g=new It(0,0),d=(new It(0,0),new It(0,0),new It(0,0)),e=(t[0].position=new It(e.x,e.y),Vt.degreesToRadian(s)),_=Vt.radianToDirection(e);_.normalize();for(let e=1;e<i;++e)t[e].force=_.multiplyByScaler(t[e].acceleration).add(r),t[e].lastPosition=new It(t[e].position.x,t[e].position.y),l=t[e].delay*n*30,g=t[e].position.substract(t[e-1].position),h=Vt.directionToRadian(t[e].lastGravity,_)/o,g.x=Vt.cos(h)*g.x-g.y*Vt.sin(h),g.y=Vt.sin(h)*g.x+g.y*Vt.cos(h),t[e].position=t[e-1].position.add(g),h=t[e].velocity.multiplyByScaler(l),u=t[e].force.multiplyByScaler(l).multiplyByScaler(l),t[e].position=t[e].position.add(h).add(u),(d=t[e].position.substract(t[e-1].position)).normalize(),t[e].position=t[e-1].position.add(d.multiplyByScaler(t[e].radius)),Vt.abs(t[e].position.x)<a&&(t[e].position.x=0),0!=l&&(t[e].velocity=t[e].position.substract(t[e].lastPosition),t[e].velocity=t[e].velocity.divisionByScalar(l),t[e].velocity=t[e].velocity.multiplyByScaler(t[e].mobility)),t[e].force=new It(0,0),t[e].lastGravity=new It(_.x,_.y)}function pi(t,i,e,s,r,a){let n=new It(0,0);t[0].position=new It(e.x,e.y);var e=Vt.degreesToRadian(s),o=Vt.radianToDirection(e);o.normalize();for(let e=1;e<i;++e)t[e].force=o.multiplyByScaler(t[e].acceleration).add(r),t[e].lastPosition=new It(t[e].position.x,t[e].position.y),t[e].velocity=new It(0,0),(n=t[e].force).normalize(),n=n.multiplyByScaler(t[e].radius),t[e].position=t[e-1].position.add(n),Vt.abs(t[e].position.x)<a&&(t[e].position.x=0),t[e].force=new It(0,0),t[e].lastGravity=new It(o.x,o.y)}function fi(e,t,i,s,r){let a;(a=s*r.getScale(r.translationScale,r.angleScale))<t?(a<r.valueBelowMinimum&&(r.valueBelowMinimum=a),a=t):a>i&&(a>r.valueExceededMaximum&&(r.valueExceededMaximum=a),a=i);s=r.weight/100;1<=s||(a=e[0]*(1-s)+a*s),e[0]=a}function yi(e,t,i,s,r,a,n,o){let l=0;var h=Vt.max(i,t),u=(h<e&&(e=h),Vt.min(i,t)),g=(e<u&&(e=u),Vt.min(r,a)),d=Vt.max(r,a),_=n,m=gi(u,h),c=e-m;switch((()=>{let e=0;return 0<c?e=1:c<0&&(e=-1),e})()){case 1:{let e=h-m;0!=e&&(l=c*((d-_)/e),l+=_);break}case-1:{let e=u-m;0!=e&&(l=c*((g-_)/e),l+=_);break}case 0:l=_}return o?l:-1*l}(e=>{e.CubismPhysics=ii,e.Options=si})(Si=Si||{});class Ci{constructor(t){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new e,this._clippingContextListForDraw=new e,this._channelColors=new e,this._tmpBoundsOnModel=new m,this._tmpMatrix=new c,this._tmpMatrixForMask=new c,this._tmpMatrixForDraw=new c,this._clippingContexttConstructor=t;let i=new f;i.r=1,i.g=0,i.b=0,i.a=0,this._channelColors.pushBack(i),(i=new f).r=0,i.g=1,i.b=0,i.a=0,this._channelColors.pushBack(i),(i=new f).r=0,i.g=0,i.b=1,i.a=0,this._channelColors.pushBack(i),(i=new f).r=0,i.g=0,i.b=0,i.a=1,this._channelColors.pushBack(i)}release(){for(let e=0;e<this._clippingContextListForMask.getSize();e++)this._clippingContextListForMask.at(e)&&(this._clippingContextListForMask.at(e).release(),this._clippingContextListForMask.set(e,void 0)),this._clippingContextListForMask.set(e,null);this._clippingContextListForMask=null;for(let e=0;e<this._clippingContextListForDraw.getSize();e++)this._clippingContextListForDraw.set(e,null);this._clippingContextListForDraw=null;for(let e=0;e<this._channelColors.getSize();e++)this._channelColors.set(e,null);(this._channelColors=null)!=this._clearedFrameBufferFlags&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(i,t){t%1!=0&&(v("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),t=~~t),t<1&&v("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=t<1?1:t,this._clearedFrameBufferFlags=new e(this._renderTextureCount);for(let t=0;t<i.getDrawableCount();t++)if(i.getDrawableMaskCounts()[t]<=0)this._clippingContextListForDraw.pushBack(null);else{let e=this.findSameClip(i.getDrawableMasks()[t],i.getDrawableMaskCounts()[t]);null==e&&(e=new this._clippingContexttConstructor(this,i.getDrawableMasks()[t],i.getDrawableMaskCounts()[t]),this._clippingContextListForMask.pushBack(e)),e.addClippedDrawable(t),this._clippingContextListForDraw.pushBack(e)}}findSameClip(i,t){for(let e=0;e<this._clippingContextListForMask.getSize();e++){var s=this._clippingContextListForMask.at(e),r=s._clippingIdCount;if(r==t){let t=0;for(let e=0;e<r;e++){var a=s._clippingIdList[e];for(let e=0;e<r;e++)if(i[e]==a){t++;break}}if(t==r)return s}}return null}setupMatrixForHighPrecision(s,r){let t=0;for(let e=0;e<this._clippingContextListForMask.getSize();e++){var i=this._clippingContextListForMask.at(e);this.calcClippedDrawTotalBounds(s,i),i._isUsing&&t++}if(0<t){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferFlags.set(e,!1);for(let i=0;i<this._clippingContextListForMask.getSize();i++){var a=this._clippingContextListForMask.at(i),n=a._allClippedDrawRect,o=a._layoutBounds;let e=0,t=0;var l=s.getPixelsPerUnit(),h=a.getClippingManager().getClippingMaskBufferSize(),u=o.width*h,h=o.height*h;this._tmpBoundsOnModel.setRect(n),e=this._tmpBoundsOnModel.width*l>u?(this._tmpBoundsOnModel.expand(.05*n.width,0),o.width/this._tmpBoundsOnModel.width):l/u,t=this._tmpBoundsOnModel.height*l>h?(this._tmpBoundsOnModel.expand(0,.05*n.height),o.height/this._tmpBoundsOnModel.height):l/h,this.createMatrixForMask(r,o,e,t),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(e,t,i,s){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(t.x,t.y),this._tmpMatrix.scaleRelative(i,s),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(t.x,t.y*(e?-1:1)),this._tmpMatrix.scaleRelative(i,s*(e?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(n){let o=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(n<=0||n>o){n>o&&b("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",n-o,this._renderTextureCount,n);for(let t=0;t<this._clippingContextListForMask.getSize();t++){let e=this._clippingContextListForMask.at(t);e._layoutChannelIndex=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}}else{let e=this._renderTextureCount<=1?9:8;var i=n/this._renderTextureCount;let t=n%this._renderTextureCount;var l=(i=Math.ceil(i))%4,h=~~(i/4);let a=0;for(let r=0;r<this._renderTextureCount;r++)for(let s=0;s<4;s++){let i=h+(s<l?1:0);if(s==l+(h<1?-1:0)&&0<t&&(i-=r<t?0:1),0!=i)if(1==i){let e=this._clippingContextListForMask.at(a++);e._layoutChannelIndex=s,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=r}else if(2==i)for(let t=0;t<i;t++){var u=~~(t%2);let e=this._clippingContextListForMask.at(a++);e._layoutChannelIndex=s,e._layoutBounds.x=.5*u,e._layoutBounds.y=0,e._layoutBounds.width=.5,e._layoutBounds.height=1,e._bufferIndex=r}else if(i<=4)for(let t=0;t<i;t++){var g=~~(t%2),d=~~(t/2);let e=this._clippingContextListForMask.at(a++);e._layoutChannelIndex=s,e._layoutBounds.x=.5*g,e._layoutBounds.y=.5*d,e._layoutBounds.width=.5,e._layoutBounds.height=.5,e._bufferIndex=r}else if(i<=e)for(let t=0;t<i;t++){var _=~~(t%3),m=~~(t/3);let e=this._clippingContextListForMask.at(a++);e._layoutChannelIndex=s,e._layoutBounds.x=_/3,e._layoutBounds.y=m/3,e._layoutBounds.width=1/3,e._layoutBounds.height=1/3,e._bufferIndex=r}else{b("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",n-o,this._renderTextureCount,n);for(let e=0;e<i;e++){let e=this._clippingContextListForMask.at(a++);e._layoutChannelIndex=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}}}}}calcClippedDrawTotalBounds(l,h){let u=Number.MAX_VALUE,g=Number.MAX_VALUE,d=Number.MIN_VALUE,_=Number.MIN_VALUE,e=h._clippedDrawableIndexList.length;for(let i=0;i<e;i++){let e=h._clippedDrawableIndexList[i],t=l.getDrawableVertexCount(e),s=l.getDrawableVertices(e),r=Number.MAX_VALUE,a=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=-Number.MAX_VALUE;var m=t*W.vertexStep;for(let i=W.vertexOffset;i<m;i+=W.vertexStep){let e=s[i],t=s[i+1];e<r&&(r=e),e>n&&(n=e),t<a&&(a=t),t>o&&(o=t)}if(r!=Number.MAX_VALUE)if(r<u&&(u=r),a<g&&(g=a),n>d&&(d=n),o>_&&(_=o),u==Number.MAX_VALUE)h._allClippedDrawRect.x=0,h._allClippedDrawRect.y=0,h._allClippedDrawRect.width=0,h._allClippedDrawRect.height=0,h._isUsing=!1;else{h._isUsing=!0;let e=d-u,t=_-g;h._allClippedDrawRect.x=u,h._allClippedDrawRect.y=g,h._allClippedDrawRect.width=e,h._allClippedDrawRect.height=t}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(e){return this._channelColors.at(e)}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}}let xi;class Mi{constructor(){this._shaderSets=new e}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(s,e,t){let i,r,a,n;s.isPremultipliedAlpha()||b("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();var o=null!=s.getClippingContextBufferForDraw(),l=e.getDrawableInvertedMaskBit(t),u=o?l?2:1:0;let g;switch(e.getDrawableBlendMode(t)){case h.CubismBlendMode_Normal:default:g=this._shaderSets.at(Pi.ShaderNames_NormalPremultipliedAlpha+u),i=this.gl.ONE,r=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ONE,n=this.gl.ONE_MINUS_SRC_ALPHA;break;case h.CubismBlendMode_Additive:g=this._shaderSets.at(Pi.ShaderNames_AddPremultipliedAlpha+u),i=this.gl.ONE,r=this.gl.ONE,a=this.gl.ZERO,n=this.gl.ONE;break;case h.CubismBlendMode_Multiplicative:g=this._shaderSets.at(Pi.ShaderNames_MultPremultipliedAlpha+u),i=this.gl.DST_COLOR,r=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ZERO,n=this.gl.ONE}this.gl.useProgram(g.shaderProgram),null==s._bufferData.vertex&&(s._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s._bufferData.vertex);l=e.getDrawableVertices(t),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributePositionLocation),this.gl.vertexAttribPointer(g.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==s._bufferData.uv&&(s._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s._bufferData.uv),l=e.getDrawableVertexUvs(t);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributeTexCoordLocation),this.gl.vertexAttribPointer(g.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),o){this.gl.activeTexture(this.gl.TEXTURE1);let e=s.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(s.getClippingContextBufferForDraw()._bufferIndex),t=(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(g.samplerTexture1Location,1),this.gl.uniformMatrix4fv(g.uniformClipMatrixLocation,!1,s.getClippingContextBufferForDraw()._matrixForDraw.getArray()),s.getClippingContextBufferForDraw()._layoutChannelIndex),i=s.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(t);this.gl.uniform4f(g.uniformChannelFlagLocation,i.r,i.g,i.b,i.a)}var l=e.getDrawableTextureIndex(t),o=s.getBindedTextures().getValue(l),l=(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.uniform1i(g.samplerTexture0Location,0),s.getMvpMatrix()),o=(this.gl.uniformMatrix4fv(g.uniformMatrixLocation,!1,l.getArray()),s.getModelColorWithOpacity(e.getDrawableOpacity(t))),l=e.getMultiplyColor(t),d=e.getScreenColor(t),o=(this.gl.uniform4f(g.uniformBaseColorLocation,o.r,o.g,o.b,o.a),this.gl.uniform4f(g.uniformMultiplyColorLocation,l.r,l.g,l.b,l.a),this.gl.uniform4f(g.uniformScreenColorLocation,d.r,d.g,d.b,d.a),null==s._bufferData.index&&(s._bufferData.index=this.gl.createBuffer()),e.getDrawableVertexIndices(t));this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,s._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(i,r,a,n)}setupShaderProgramForMask(e,t,i){e.isPremultipliedAlpha()||b("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();var s=this._shaderSets.at(Pi.ShaderNames_SetupMask),r=(this.gl.useProgram(s.shaderProgram),null==e._bufferData.vertex&&(e._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.vertex),t.getDrawableVertices(i)),r=(this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributePositionLocation),this.gl.vertexAttribPointer(s.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==e._bufferData.uv&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv),t.getDrawableTextureIndex(i)),r=e.getBindedTextures().getValue(r),r=(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(s.samplerTexture0Location,0),null==e._bufferData.uv&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv),t.getDrawableVertexUvs(i)),r=(this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributeTexCoordLocation),this.gl.vertexAttribPointer(s.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),e.getClippingContextBufferForMask(),e.getClippingContextBufferForMask()._layoutChannelIndex),r=e.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(r),r=(this.gl.uniform4f(s.uniformChannelFlagLocation,r.r,r.g,r.b,r.a),this.gl.uniformMatrix4fv(s.uniformClipMatrixLocation,!1,e.getClippingContextBufferForMask()._matrixForMask.getArray()),e.getClippingContextBufferForMask()._layoutBounds),r=(this.gl.uniform4f(s.uniformBaseColorLocation,2*r.x-1,2*r.y-1,2*r.getRight()-1,2*r.getBottom()-1),t.getMultiplyColor(i)),a=t.getScreenColor(i),r=(this.gl.uniform4f(s.uniformMultiplyColorLocation,r.r,r.g,r.b,r.a),this.gl.uniform4f(s.uniformScreenColorLocation,a.r,a.g,a.b,a.a),this.gl.ZERO),s=this.gl.ONE_MINUS_SRC_COLOR,a=this.gl.ZERO,n=this.gl.ONE_MINUS_SRC_ALPHA,t=(null==e._bufferData.index&&(e._bufferData.index=this.gl.createBuffer()),t.getDrawableVertexIndices(i));this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,s,a,n)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.getSize();e++)this.gl.deleteProgram(this._shaderSets.at(e).shaderProgram),this._shaderSets.at(e).shaderProgram=0,this._shaderSets.set(e,void 0),this._shaderSets.set(e,null)}generateShaders(){for(let e=0;e<10;e++)this._shaderSets.pushBack(new bi);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(Bi,wi),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(Fi,Vi),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Ii,Ei),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Ii,Ri),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(e,t){var i=this.gl.createProgram(),e=this.compileShaderSource(this.gl.VERTEX_SHADER,e);return e&&(t=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t))?(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(e),this.gl.deleteShader(t),i):(b("Failed to link program: {0}",i),this.gl.deleteShader(e),this.gl.deleteShader(t),i&&this.gl.deleteProgram(i),0)):(b("Vertex shader compile error!"),0)}compileShaderSource(e,t){var i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!i){let e=this.gl.getShaderInfoLog(i);b("Shader compile log: {0} ",e)}return this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}setGl(e){this.gl=e}}class vi{static getInstance(){return xi=null==xi?new vi:xi}static deleteInstance(){xi&&(xi.release(),xi=null)}constructor(){this._shaderMap=new I}release(){for(var e=this._shaderMap.begin();e.notEqual(this._shaderMap.end());e.preIncrement())e.ptr().second.release();this._shaderMap.clear()}getShader(e){return this._shaderMap.getValue(e)}setGlContext(e){var t;this._shaderMap.isExist(e)||((t=new Mi).setGl(e),this._shaderMap.setValue(e,t))}}class bi{}(e=>{e[e.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",e[e.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",e[e.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",e[e.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",e[e.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",e[e.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted"})(Pi=Pi||{});let Bi="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",wi="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",Fi="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ii="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Vi="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Ei="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",Ri="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}",Li,Di;(e=>{e.CubismShaderSet=bi,e.CubismShader_WebGL=Mi,e.CubismShaderManager_WebGL=vi,e.ShaderNames=Pi})(Ti=Ti||{});class Ai extends Ci{getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{null!=this._maskRenderTextures&&this._maskRenderTextures.clear(),this._maskRenderTextures=new e,null!=this._maskColorBuffers&&this._maskColorBuffers.clear(),this._maskColorBuffers=new e;var t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Di),this._maskTexture=new Oi(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(e){this.gl=e}constructor(){super(ki)}setupClippingContext(r,a){this._currentFrameNo++;let i=0;for(let t=0;t<this._clippingContextListForMask.getSize();t++){let e=this._clippingContextListForMask.at(t);this.calcClippedDrawTotalBounds(r,e),e._isUsing&&i++}if(0<i){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),a.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new e(this._renderTextureCount));for(let e=0;e<this._clearedFrameBufferFlags.getSize();e++)this._clearedFrameBufferFlags.set(e,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){let t=this._clippingContextListForMask.at(s),e=t._allClippedDrawRect,i=t._layoutBounds;var n,o=this.getMaskRenderTexture().at(t._bufferIndex),l=(this._currentMaskRenderTexture!=o&&(this._currentMaskRenderTexture=o,a.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(e),this._tmpBoundsOnModel.expand(.05*e.width,.05*e.height),o=i.width/this._tmpBoundsOnModel.width,n=i.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(i.x,i.y),this._tmpMatrix.scaleRelative(o,n),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(i.x,i.y),this._tmpMatrix.scaleRelative(o,n),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),t._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),t._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),t._clippingIdCount);for(let e=0;e<l;e++){var h=t._clippingIdList[e];r.getDrawableDynamicFlagVertexPositionsDidChange(h)&&(a.setIsCulling(0!=r.getDrawableCulling(h)),this._clearedFrameBufferFlags.at(t._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(t._bufferIndex,!0)),a.setClippingContextBufferForMask(t),a.drawMeshWebGL(r,h))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Di),a.setClippingContextBufferForMask(null),this.gl.viewport(Li[0],Li[1],Li[2],Li[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Oi{constructor(e,t){this.frameNo=e,this.textures=t}}class ki extends y{constructor(e,t,i){super(t,i),this._owner=e}getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}}class Ni{setGlEnable(e,t){t?this.gl.enable(e):this.gl.disable(e)}setGlEnableVertexAttribArray(e,t){t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}save(){null!=this.gl?(this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)):b("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}restore(){null!=this.gl?(this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])):b("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}setGl(e){this.gl=e}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class zi extends p{initialize(e,t=1){e.isUsingMasking()&&(this._clippingManager=new Ai,this._clippingManager.initialize(e,t)),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),super.initialize(e)}bindTexture(e,t){this._textures.setValue(e,t)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){var t;this._model.isUsingMasking()&&(t=this._clippingManager.getRenderTextureCount(),this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Ai,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),t))}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Ni,this.firstDraw=!0,this._textures=new I,this._sortedDrawableIndexList=new e,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),null!=this.gl&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(null==this.gl)b("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");else{null!=this._clippingManager&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();let e=this.getModel().getDrawableCount(),i=this.getModel().getDrawableRenderOrders();for(let t=0;t<e;++t){let e=i[t];this._sortedDrawableIndexList.set(e,t)}for(let t=0;t<e;++t){let e=this._sortedDrawableIndexList.at(t);if(this.getModel().getDrawableDynamicFlagIsVisible(e)){var s=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(e):null;if(null!=s&&this.isUsingHighPrecisionMask()){s._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s.getClippingManager().getMaskRenderTexture().at(s._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{let e=s._clippingIdCount;for(let t=0;t<e;t++){let e=s._clippingIdList[t];this._model.getDrawableDynamicFlagVertexPositionsDidChange(e)&&(this.setIsCulling(0!=this._model.getDrawableCulling(e)),this.setClippingContextBufferForMask(s),this.drawMeshWebGL(this._model,e))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Di),this.setClippingContextBufferForMask(null),this.gl.viewport(Li[0],Li[1],Li[2],Li[3]),this.preDraw()}this.setClippingContextBufferForDraw(s),this.setIsCulling(this.getModel().getDrawableCulling(e)),this.drawMeshWebGL(this._model,e)}}}}drawMeshWebGL(e,t){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?vi.getInstance().getShader(this.gl).setupShaderProgramForMask(this,e,t):vi.getInstance().getShader(this.gl).setupShaderProgramForDraw(this,e,t);e=e.getDrawableVertexIndexCount(t);this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){vi.deleteInstance()}setRenderState(e,t){Di=e,Li=t}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),0<this.getAnisotropy()&&this._extension)for(let e=0;e<this._textures.getSize();++e)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(e)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return null!=this.getClippingContextBufferForMask()}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),vi.getInstance().setGlContext(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}p.staticRelease=()=>{zi.doStaticRelease()},(e=>{e.CubismClippingContext=ki,e.CubismClippingManager_WebGL=Ai,e.CubismRenderTextureResource=Oi,e.CubismRenderer_WebGL=zi})(Ui=Ui||{});class Yi{constructor(e=!1,t=!1){this.isOverridden=e,this.isParameterRepeated=t}}class ji{constructor(e=!1,t=new f){this.isOverridden=e,this.color=t}get isOverwritten(){return this.isOverridden}}class Hi{constructor(e=!1,t=new f){this.isOverridden=e,this.color=t}get isOverwritten(){return this.isOverridden}}class qi{constructor(e=!1,t=!1){this.isOverridden=e,this.isCulling=t}get isOverwritten(){return this.isOverridden}}class Wi{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){var t=this._model.parameters.count,i=this._savedParameters.getSize();for(let e=0;e<t;++e)e<i?this._savedParameters.set(e,this._parameterValues[e]):this._savedParameters.pushBack(this._parameterValues[e])}getMultiplyColor(e){return this.getOverrideFlagForModelMultiplyColors()||this.getOverrideFlagForDrawableMultiplyColors(e)?this._userMultiplyColors.at(e).color:this.getDrawableMultiplyColor(e)}getScreenColor(e){return this.getOverrideFlagForModelScreenColors()||this.getOverrideFlagForDrawableScreenColors(e)?this._userScreenColors.at(e).color:this.getDrawableScreenColor(e)}setMultiplyColorByTextureColor(e,t){this.setMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setMultiplyColorByRGBA(e,t,i,s,r=1){this._userMultiplyColors.at(e).color.r=t,this._userMultiplyColors.at(e).color.g=i,this._userMultiplyColors.at(e).color.b=s,this._userMultiplyColors.at(e).color.a=r}setScreenColorByTextureColor(e,t){this.setScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setScreenColorByRGBA(e,t,i,s,r=1){this._userScreenColors.at(e).color.r=t,this._userScreenColors.at(e).color.g=i,this._userScreenColors.at(e).color.b=s,this._userScreenColors.at(e).color.a=r}getPartMultiplyColor(e){return this._userPartMultiplyColors.at(e).color}getPartScreenColor(e){return this._userPartScreenColors.at(e).color}setPartColor(t,i,s,r,a,e,n){if(e.at(t).color.r=i,e.at(t).color.g=s,e.at(t).color.b=r,e.at(t).color.a=a,e.at(t).isOverridden)for(let e=0;e<this._partChildDrawables.at(t).getSize();++e){var o=this._partChildDrawables.at(t).at(e);n.at(o).color.r=i,n.at(o).color.g=s,n.at(o).color.b=r,n.at(o).color.a=a}}setPartMultiplyColorByTextureColor(e,t){this.setPartMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartMultiplyColorByRGBA(e,t,i,s,r){this.setPartColor(e,t,i,s,r,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(e,t){this.setPartScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartScreenColorByRGBA(e,t,i,s,r){this.setPartColor(e,t,i,s,r,this._userPartScreenColors,this._userScreenColors)}getOverrideFlagForModelParameterRepeat(){return this._isOverriddenParameterRepeat}setOverrideFlagForModelParameterRepeat(e){this._isOverriddenParameterRepeat=e}getOverrideFlagForParameterRepeat(e){return this._userParameterRepeatDataList.at(e).isOverridden}setOverrideFlagForParameterRepeat(e,t){this._userParameterRepeatDataList.at(e).isOverridden=t}getRepeatFlagForParameterRepeat(e){return this._userParameterRepeatDataList.at(e).isParameterRepeated}setRepeatFlagForParameterRepeat(e,t){this._userParameterRepeatDataList.at(e).isParameterRepeated=t}getOverwriteFlagForModelMultiplyColors(){return v("getOverwriteFlagForModelMultiplyColors() is a deprecated function. Please use getOverrideFlagForModelMultiplyColors()."),this.getOverrideFlagForModelMultiplyColors()}getOverrideFlagForModelMultiplyColors(){return this._isOverriddenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return v("getOverwriteFlagForModelScreenColors() is a deprecated function. Please use getOverrideFlagForModelScreenColors()."),this.getOverrideFlagForModelScreenColors()}getOverrideFlagForModelScreenColors(){return this._isOverriddenModelScreenColors}setOverwriteFlagForModelMultiplyColors(e){v("setOverwriteFlagForModelMultiplyColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelMultiplyColors(value: boolean)."),this.setOverrideFlagForModelMultiplyColors(e)}setOverrideFlagForModelMultiplyColors(e){this._isOverriddenModelMultiplyColors=e}setOverwriteFlagForModelScreenColors(e){v("setOverwriteFlagForModelScreenColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelScreenColors(value: boolean)."),this.setOverrideFlagForModelScreenColors(e)}setOverrideFlagForModelScreenColors(e){this._isOverriddenModelScreenColors=e}getOverwriteFlagForDrawableMultiplyColors(e){return v("getOverwriteFlagForDrawableMultiplyColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableMultiplyColors(drawableindex: number)."),this.getOverrideFlagForDrawableMultiplyColors(e)}getOverrideFlagForDrawableMultiplyColors(e){return this._userMultiplyColors.at(e).isOverridden}getOverwriteFlagForDrawableScreenColors(e){return v("getOverwriteFlagForDrawableScreenColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableScreenColors(drawableindex: number)."),this.getOverrideFlagForDrawableScreenColors(e)}getOverrideFlagForDrawableScreenColors(e){return this._userScreenColors.at(e).isOverridden}setOverwriteFlagForDrawableMultiplyColors(e,t){v("setOverwriteFlagForDrawableMultiplyColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableMultiplyColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableMultiplyColors(e,t)}setOverrideFlagForDrawableMultiplyColors(e,t){this._userMultiplyColors.at(e).isOverridden=t}setOverwriteFlagForDrawableScreenColors(e,t){v("setOverwriteFlagForDrawableScreenColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableScreenColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableScreenColors(e,t)}setOverrideFlagForDrawableScreenColors(e,t){this._userScreenColors.at(e).isOverridden=t}getOverwriteColorForPartMultiplyColors(e){return v("getOverwriteColorForPartMultiplyColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartMultiplyColors(partIndex: number)."),this.getOverrideColorForPartMultiplyColors(e)}getOverrideColorForPartMultiplyColors(e){return this._userPartMultiplyColors.at(e).isOverridden}getOverwriteColorForPartScreenColors(e){return v("getOverwriteColorForPartScreenColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartScreenColors(partIndex: number)."),this.getOverrideColorForPartScreenColors(e)}getOverrideColorForPartScreenColors(e){return this._userPartScreenColors.at(e).isOverridden}setOverwriteColorForPartColors(e,t,i,s){v("setOverwriteColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>) is a deprecated function. Please use setOverrideColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>)."),this.setOverrideColorForPartColors(e,t,i,s)}setOverrideColorForPartColors(t,i,s,r){s.at(t).isOverridden=i;for(let e=0;e<this._partChildDrawables.at(t).getSize();++e){var a=this._partChildDrawables.at(t).at(e);(r.at(a).isOverridden=i)&&(r.at(a).color.r=s.at(t).color.r,r.at(a).color.g=s.at(t).color.g,r.at(a).color.b=s.at(t).color.b,r.at(a).color.a=s.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(e,t){v("setOverwriteColorForPartMultiplyColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartMultiplyColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartMultiplyColors(e,t)}setOverrideColorForPartMultiplyColors(e,t){this._userPartMultiplyColors.at(e).isOverridden=t,this.setOverrideColorForPartColors(e,t,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(e,t){v("setOverwriteColorForPartScreenColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartScreenColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartScreenColors(e,t)}setOverrideColorForPartScreenColors(e,t){this._userPartScreenColors.at(e).isOverridden=t,this.setOverrideColorForPartColors(e,t,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(e){var t;return this.getOverrideFlagForModelCullings()||this.getOverrideFlagForDrawableCullings(e)?this._userCullings.at(e).isCulling:(t=this._model.drawables.constantFlags,!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e]))}setDrawableCulling(e,t){this._userCullings.at(e).isCulling=t}getOverwriteFlagForModelCullings(){return v("getOverwriteFlagForModelCullings() is a deprecated function. Please use getOverrideFlagForModelCullings()."),this.getOverrideFlagForModelCullings()}getOverrideFlagForModelCullings(){return this._isOverriddenCullings}setOverwriteFlagForModelCullings(e){v("setOverwriteFlagForModelCullings(isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForModelCullings(isOverriddenCullings: boolean)."),this.setOverrideFlagForModelCullings(e)}setOverrideFlagForModelCullings(e){this._isOverriddenCullings=e}getOverwriteFlagForDrawableCullings(e){return v("getOverwriteFlagForDrawableCullings(drawableIndex: number) is a deprecated function. Please use getOverrideFlagForDrawableCullings(drawableIndex: number)."),this.getOverrideFlagForDrawableCullings(e)}getOverrideFlagForDrawableCullings(e){return this._userCullings.at(e).isOverridden}setOverwriteFlagForDrawableCullings(e,t){v("setOverwriteFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean)."),this.setOverrideFlagForDrawableCullings(e,t)}setOverrideFlagForDrawableCullings(e,t){this._userCullings.at(e).isOverridden=t}getModelOapcity(){return this._modelOpacity}setModelOapcity(e){this._modelOpacity=e}getModel(){return this._model}getPartIndex(e){let t;var i=this._model.parts.count;for(t=0;t<i;++t)if(e==this._partIds.at(t))return t;return this._notExistPartId.isExist(e)?this._notExistPartId.getValue(e):(t=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(e,t),this._notExistPartOpacities.appendKey(t),t)}getPartId(e){e=this._model.parts.ids[e];return $.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}getPartParentPartIndices(){return this._model.parts.parentIndices}setPartOpacityByIndex(e,t){this._notExistPartOpacities.isExist(e)?this._notExistPartOpacities.setValue(e,t):(C(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t)}setPartOpacityById(e,t){e=this.getPartIndex(e);e<0||this.setPartOpacityByIndex(e,t)}getPartOpacityByIndex(e){return this._notExistPartOpacities.isExist(e)?this._notExistPartOpacities.getValue(e):(C(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){e=this.getPartIndex(e);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(e){let t;var i=this._model.parameters.count;for(t=0;t<i;++t)if(e==this._parameterIds.at(t))return t;return this._notExistParameterId.isExist(e)?this._notExistParameterId.getValue(e):(t=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(e,t),this._notExistParameterValues.appendKey(t),t)}getParameterCount(){return this._model.parameters.count}getParameterType(e){return this._model.parameters.types[e]}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterId(e){return $.getIdManager().getId(this._model.parameters.ids[e])}getParameterValueByIndex(e){return this._notExistParameterValues.isExist(e)?this._notExistParameterValues.getValue(e):(C(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){e=this.getParameterIndex(e);return this.getParameterValueByIndex(e)}setParameterValueByIndex(e,t,i=1){this._notExistParameterValues.isExist(e)?this._notExistParameterValues.setValue(e,1==i?t:this._notExistParameterValues.getValue(e)*(1-i)+t*i):(C(0<=e&&e<this.getParameterCount()),t=this.isRepeat(e)?this.getParameterRepeatValue(e,t):this.getParameterClampValue(e,t),this._parameterValues[e]=1==i?t:this._parameterValues[e]=this._parameterValues[e]*(1-i)+t*i)}setParameterValueById(e,t,i=1){e=this.getParameterIndex(e);this.setParameterValueByIndex(e,t,i)}addParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*i)}addParameterValueById(e,t,i=1){e=this.getParameterIndex(e);this.addParameterValueByIndex(e,t,i)}isRepeat(e){return!this._notExistParameterValues.isExist(e)&&(C(0<=e&&e<this.getParameterCount()),this._isOverriddenParameterRepeat||this._userParameterRepeatDataList.at(e).isOverridden?this._userParameterRepeatDataList.at(e).isParameterRepeated:0!=this._model.parameters.repeats[e])}getParameterRepeatValue(e,t){if(!this._notExistParameterValues.isExist(e)){C(0<=e&&e<this.getParameterCount());var i=this._model.parameters.maximumValues[e],s=this._model.parameters.minimumValues[e],r=i-s;if(i<t){let e=Vt.mod(t-i,r);t=Number.isNaN(e)?i:s+e}if(t<s){let e=Vt.mod(s-t,r);t=Number.isNaN(e)?s:i-e}}return t}getParameterClampValue(e,t){if(this._notExistParameterValues.isExist(e))return t;C(0<=e&&e<this.getParameterCount());var i=this._model.parameters.maximumValues[e],e=this._model.parameters.minimumValues[e];return Vt.clamp(t,e,i)}getParameterRepeats(e){return 0!=this._model.parameters.repeats[e]}multiplyParameterValueById(e,t,i=1){e=this.getParameterIndex(e);this.multiplyParameterValueByIndex(e,t,i)}multiplyParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*i))}getDrawableIndex(t){var i=this._model.drawables.count;for(let e=0;e<i;++e)if(this._drawableIds.at(e)==t)return e;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){var t=this._model.drawables.ids;return $.getIdManager().getId(t[e])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this.getDrawableTextureIndex(e)}getDrawableTextureIndex(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableMultiplyColor(e){var t=this._model.drawables.multiplyColors,e=4*e,i=new f;return i.r=t[e],i.g=t[1+e],i.b=t[2+e],i.a=t[3+e],i}getDrawableScreenColor(e){var t=this._model.drawables.screenColors,e=4*e,i=new f;return i.r=t[e],i.g=t[1+e],i.b=t[2+e],i.a=t[3+e],i}getDrawableParentPartIndex(e){return this._model.drawables.parentPartIndices[e]}getDrawableBlendMode(e){var t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?h.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?h.CubismBlendMode_Multiplicative:h.CubismBlendMode_Normal}getDrawableInvertedMaskBit(e){var t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}getDrawableDynamicFlagBlendColorDidChange(e){var t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(t[e])}loadParameters(){let t=this._model.parameters.count;var e=this._savedParameters.getSize();t>e&&(t=e);for(let e=0;e<t;++e)this._parameterValues[e]=this._savedParameters.at(e)}initialize(){C(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{let t=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i),this._userParameterRepeatDataList.prepareCapacity(i);for(let e=0;e<i;++e)this._parameterIds.pushBack($.getIdManager().getId(t[e])),this._userParameterRepeatDataList.pushBack(new Yi(!1,!1))}let i=this._model.parts.count;{let t=this._model.parts.ids;this._partIds.prepareCapacity(i);for(let e=0;e<i;++e)this._partIds.pushBack($.getIdManager().getId(t[e]));this._userPartMultiplyColors.prepareCapacity(i),this._userPartScreenColors.prepareCapacity(i),this._partChildDrawables.prepareCapacity(i)}var a=this._model.drawables.ids,n=this._model.drawables.count,o=(this._userMultiplyColors.prepareCapacity(n),this._userScreenColors.prepareCapacity(n),this._userCullings.prepareCapacity(n),new qi(!1,!1));for(let a=0;a<i;++a){let t=new f(1,1,1,1),i=new f(0,0,0,1),s=new Hi(!1,t),r=new Hi(!1,i);this._userPartMultiplyColors.pushBack(s),this._userPartScreenColors.pushBack(r),this._partChildDrawables.pushBack(new e),this._partChildDrawables.at(a).prepareCapacity(n)}for(let r=0;r<n;++r){let e=new f(1,1,1,1),t=new f(0,0,0,1),i=new ji(!1,e),s=new ji(!1,t);this._drawableIds.pushBack($.getIdManager().getId(a[r])),this._userMultiplyColors.pushBack(i),this._userScreenColors.pushBack(s),this._userCullings.pushBack(o);var l=this.getDrawableParentPartIndex(r);0<=l&&this._partChildDrawables.at(l).pushBack(r)}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new e,this._parameterIds=new e,this._drawableIds=new e,this._partIds=new e,this._isOverriddenParameterRepeat=!0,this._isOverriddenModelMultiplyColors=!1,this._isOverriddenModelScreenColors=!1,this._isOverriddenCullings=!1,this._modelOpacity=1,this._userParameterRepeatDataList=new e,this._userMultiplyColors=new e,this._userScreenColors=new e,this._userCullings=new e,this._userPartMultiplyColors=new e,this._userPartScreenColors=new e,this._partChildDrawables=new e,this._notExistPartId=new I,this._notExistParameterId=new I,this._notExistParameterValues=new I,this._notExistPartOpacities=new I}release(){this._model.release(),this._model=null}}(Gi=Gi||{}).CubismModel=Wi;class Ji{static create(e,t){let i=null;return t&&!this.hasMocConsistency(e)?b("Inconsistent MOC3."):(t=Live2DCubismCore.Moc.fromArrayBuffer(e))&&((i=new Ji(t))._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(t,e)),i}static delete(e){e._moc._release(),e._moc=null}createModel(){let e=null;var t=Live2DCubismCore.Model.fromMoc(this._moc);return t&&((e=new Wi(t)).initialize(),++this._modelCount),e}deleteModel(e){null!=e&&(e.release(),e=null,--this._modelCount)}constructor(e){this._moc=e,this._modelCount=0,this._mocVersion=0}release(){C(0==this._modelCount),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(e){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(e)}}(Xi=Xi||{}).CubismMoc=Ji;let $i="Meta",Zi="UserData";class Ki{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString($i).getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString($i).getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(e){return this._json.getRoot().getValueByString(Zi).getValueByIndex(e).getValueByString("Target").getRawString()}getUserDataId(e){return $.getIdManager().getId(this._json.getRoot().getValueByString(Zi).getValueByIndex(e).getValueByString("Id").getRawString())}getUserDataValue(e){return this._json.getRoot().getValueByString(Zi).getValueByIndex(e).getValueByString("Value").getRawString()}}(Qi=Qi||{}).CubismModelUserDataJson=Ki;class ts{}class es{static create(e,t){var i=new es;return i.parseUserData(e,t),i}static delete(e){null!=e&&e.release()}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(e,t){let i=new Ki(e,t);if(i){var s=$.getIdManager().getId("ArtMesh"),r=i.getUserDataCount();for(let t=0;t<r;t++){let e=new ts;e.targetId=i.getUserDataId(t),e.targetType=$.getIdManager().getId(i.getUserDataTargetType(t)),e.value=new g(i.getUserDataValue(t)),this._userDataNodes.pushBack(e),e.targetType==s&&this._artMeshUserDataNode.pushBack(e)}}i.release(),i=void 0}constructor(){this._userDataNodes=new e,this._artMeshUserDataNode=new e}release(){for(let e=0;e<this._userDataNodes.getSize();++e)this._userDataNodes.set(e,null);this._userDataNodes=null}}(e=>{e.CubismModelUserData=es,e.CubismModelUserDataNode=ts})(is=is||{});class rs{isInitialized(){return this._initialized}setInitialized(e){this._initialized=e}isUpdating(){return this._updating}setUpdating(e){this._updating=e}setDragging(e,t){this._dragManager.set(e,t)}setAcceleration(e,t,i){this._accelerationX=e,this._accelerationY=t,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(e){this._opacity=e}getOpacity(){return this._opacity}loadModel(e,t=!1){this._moc=Ji.create(e,t),null!=this._moc?(this._model=this._moc.createModel(),null!=this._model?(this._model.saveParameters(),this._modelMatrix=new Ft(this._model.getCanvasWidth(),this._model.getCanvasHeight())):b("Failed to CreateModel().")):b("Failed to CubismMoc.create().")}loadMotion(e,t,i,s,r,a,n,o,l=!1){if(null==e||0==t)return b("Failed to loadMotion()."),null;s=Be.create(e,t,s,r,l);if(null==s)return b("Failed to create motion from buffer in LoadMotion()"),null;if(a){let e=a.getMotionFadeInTimeValue(n,o),t=(0<=e&&s.setFadeInTime(e),a.getMotionFadeOutTimeValue(n,o));0<=t&&s.setFadeOutTime(t)}return s}loadExpression(e,t,i){return null==e||0==t?(b("Failed to loadExpression()."),null):Ot.create(e,t)}loadPose(e,t){null!=e&&0!=t?this._pose=Mt.create(e,t):b("Failed to loadPose().")}loadUserData(e,t){null!=e&&0!=t?this._modelUserData=es.create(e,t):b("Failed to loadUserData().")}loadPhysics(e,t){null!=e&&0!=t?this._physics=ii.create(e,t):b("Failed to loadPhysics().")}isHit(e,t,i){e=this._model.getDrawableIndex(e);if(e<0)return!1;var s=this._model.getDrawableVertexCount(e),r=this._model.getDrawableVertices(e);let a=r[0],n=r[0],o=r[1],l=r[1];for(let i=1;i<s;++i){let e=r[W.vertexOffset+i*W.vertexStep],t=r[W.vertexOffset+i*W.vertexStep+1];e<a&&(a=e),e>n&&(n=e),t<o&&(o=t),t>l&&(l=t)}e=this._modelMatrix.invertTransformX(t),t=this._modelMatrix.invertTransformY(i);return a<=e&&e<=n&&o<=t&&t<=l}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(e=1){this._renderer&&this.deleteRenderer(),this._renderer=new zi,this._renderer.initialize(this._model,e)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(e){M("{0}",e.s)}static cubismDefaultMotionEventCallback(e,t,i){null!=i&&i.motionEventFired(t)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new we,this._motionManager.setEventCallback(rs.cubismDefaultMotionEventCallback,this),this._expressionManager=new Zt,this._dragManager=new Et}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Mt.delete(this._pose),St.delete(this._eyeBlink),ft.delete(this._breath),this._dragManager=null,ii.delete(this._physics),es.delete(this._modelUserData),this.deleteRenderer()}}(ss=ss||{}).CubismUserModel=rs;let as=null;class ns{static getInstance(){return as=null==as?new ns:as}static releaseInstance(){null!=as&&(as=void 0),as=null}update(e){let s,r;if(null==this._pcmData||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=e,(s=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate))>this._wavFileInfo._samplesPerChannel&&(s=this._wavFileInfo._samplesPerChannel);for(let i=r=0;i<this._wavFileInfo._numberOfChannels;i++)for(let t=this._sampleOffset;t<s;t++){let e=this._pcmData[i][t];r+=e*e}return r=Math.sqrt(r/(this._wavFileInfo._numberOfChannels*(s-this._sampleOffset))),this._lastRms=r,this._sampleOffset=s,!0}start(e){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(e)}getRms(){return this._lastRms}loadWavFile(e){return new Promise(t=>{let i=!1;null!=this._pcmData&&this.releasePcmData(),(async()=>{if(this._byteReader._fileByte=await fetch(e).then(e=>e.arrayBuffer()),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,null==this._byteReader._fileByte||this._byteReader._fileSize<4)t(!1);else{this._wavFileInfo._fileName=e;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,new Error('Cannot find Signeture "fmt".');let e=this._byteReader.get32LittleEndian();if(1!=this._byteReader.get16LittleEndian())throw i=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),16<e&&(this._byteReader._readOffset+=e-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,new Error('Cannot find "data" Chunk.');{let e=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=8*e/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let t=0;t<this._wavFileInfo._samplesPerChannel;t++)for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e][t]=this.getPcmSample();i=!0,t(i)}catch(e){console.log(e)}}})().then(()=>{t(i)})})}getPcmSample(){let e;switch(this._wavFileInfo._bitsPerSample){case 8:e=this._byteReader.get8()-128,e<<=24;break;case 16:e=this._byteReader.get16LittleEndian()<<16;break;case 24:e=this._byteReader.get24LittleEndian()<<8;break;default:e=0}return e/2147483647}getPcmDataChannel(e){return this._pcmData&&e<this._pcmData.length?Float32Array.from(this._pcmData[e]):null}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e]=null;delete this._pcmData,this._pcmData=null}constructor(){this.loadFiletoBytes=(e,t)=>{this._byteReader._fileByte=e,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=t},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new os,this._byteReader=new ls}}class os{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class ls{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){var e=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,e}get16LittleEndian(){var e=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,e}get24LittleEndian(){var e=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,e}get32LittleEndian(){var e=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,e}getCheckSignature(e){var t=new Uint8Array(4),i=(new TextEncoder).encode(e);if(4!=e.length)return!1;for(let e=0;e<4;e++)t[e]=this.get8();return t[0]==i[0]&&t[1]==i[1]&&t[2]==i[2]&&t[3]==i[3]}}(e=>{e[e.LoadAssets=0]="LoadAssets",e[e.LoadModel=1]="LoadModel",e[e.WaitLoadModel=2]="WaitLoadModel",e[e.LoadExpression=3]="LoadExpression",e[e.WaitLoadExpression=4]="WaitLoadExpression",e[e.LoadPhysics=5]="LoadPhysics",e[e.WaitLoadPhysics=6]="WaitLoadPhysics",e[e.LoadPose=7]="LoadPose",e[e.WaitLoadPose=8]="WaitLoadPose",e[e.SetupEyeBlink=9]="SetupEyeBlink",e[e.SetupBreath=10]="SetupBreath",e[e.LoadUserData=11]="LoadUserData",e[e.WaitLoadUserData=12]="WaitLoadUserData",e[e.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",e[e.SetupLipSyncIds=14]="SetupLipSyncIds",e[e.SetupLayout=15]="SetupLayout",e[e.LoadMotion=16]="LoadMotion",e[e.WaitLoadMotion=17]="WaitLoadMotion",e[e.CompleteInitialize=18]="CompleteInitialize",e[e.CompleteSetupModel=19]="CompleteSetupModel",e[e.LoadTexture=20]="LoadTexture",e[e.WaitLoadTexture=21]="WaitLoadTexture",e[e.CompleteSetup=22]="CompleteSetup"})(hs=hs||{});class gs extends rs{loadAssets(e,t){this._modelHomeDir=e,fetch(""+this._modelHomeDir+t).then(e=>e.arrayBuffer()).then(e=>{e=new pt(e,e.byteLength);this._state=hs.LoadModel,this.setupModel(e)}).catch(e=>{b("Failed to load file "+this._modelHomeDir+t)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,""!=this._modelSetting.getModelFileName()){let t=this._modelSetting.getModelFileName();fetch(""+this._modelHomeDir+t).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+t),new ArrayBuffer(0)):void 0).then(e=>{this.loadModel(e,this._mocConsistency),this._state=hs.LoadExpression,i()}),this._state=hs.WaitLoadModel}else at.printMessage("Model data does not exist.");let i=()=>{if(0<this._modelSetting.getExpressionCount()){let s=this._modelSetting.getExpressionCount();for(let e=0;e<s;e++){let t=this._modelSetting.getExpressionName(e),i=this._modelSetting.getExpressionFileName(e);fetch(""+this._modelHomeDir+i).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+i),new ArrayBuffer(0)):void 0).then(e=>{e=this.loadExpression(e,e.byteLength,t);null!=this._expressions.getValue(t)&&(Lt.delete(this._expressions.getValue(t)),this._expressions.setValue(t,null)),this._expressions.setValue(t,e),this._expressionCount++,this._expressionCount>=s&&(this._state=hs.LoadPhysics,r())})}this._state=hs.WaitLoadExpression}else this._state=hs.LoadPhysics,r()},r=()=>{if(""!=this._modelSetting.getPhysicsFileName()){let t=this._modelSetting.getPhysicsFileName();fetch(""+this._modelHomeDir+t).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+t),new ArrayBuffer(0)):void 0).then(e=>{this.loadPhysics(e,e.byteLength),this._state=hs.LoadPose,s()}),this._state=hs.WaitLoadPhysics}else this._state=hs.LoadPose,s()},s=()=>{if(""!=this._modelSetting.getPoseFileName()){let t=this._modelSetting.getPoseFileName();fetch(""+this._modelHomeDir+t).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+t),new ArrayBuffer(0)):void 0).then(e=>{this.loadPose(e,e.byteLength),this._state=hs.SetupEyeBlink,a()}),this._state=hs.WaitLoadPose}else this._state=hs.SetupEyeBlink,a()},a=()=>{0<this._modelSetting.getEyeBlinkParameterCount()&&(this._eyeBlink=St.create(this._modelSetting),this._state=hs.SetupBreath),n()},n=()=>{this._breath=ft.create();var t=new e;t.pushBack(new yt(this._idParamAngleX,0,15,6.5345,.5)),t.pushBack(new yt(this._idParamAngleY,0,8,3.5345,.5)),t.pushBack(new yt(this._idParamAngleZ,0,10,5.5345,.5)),t.pushBack(new yt(this._idParamBodyAngleX,0,4,15.5345,.5)),t.pushBack(new yt($.getIdManager().getId(ot.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(t),this._state=hs.LoadUserData,o()},o=()=>{if(""!=this._modelSetting.getUserDataFile()){let t=this._modelSetting.getUserDataFile();fetch(""+this._modelHomeDir+t).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+t),new ArrayBuffer(0)):void 0).then(e=>{this.loadUserData(e,e.byteLength),this._state=hs.SetupEyeBlinkIds,l()}),this._state=hs.WaitLoadUserData}else this._state=hs.SetupEyeBlinkIds,l()},l=()=>{var t=this._modelSetting.getEyeBlinkParameterCount();for(let e=0;e<t;++e)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(e));this._state=hs.SetupLipSyncIds,h()},h=()=>{var t=this._modelSetting.getLipSyncParameterCount();for(let e=0;e<t;++e)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(e));this._state=hs.SetupLayout,u()},u=()=>{var e=new I;null!=this._modelSetting&&null!=this._modelMatrix?(this._modelSetting.getLayoutMap(e),this._modelMatrix.setupFromLayout(e),this._state=hs.LoadMotion,g()):b("Failed to setupLayout().")},g=()=>{this._state=hs.WaitLoadMotion,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;var t=[],i=this._modelSetting.getMotionGroupCount();for(let e=0;e<i;e++)t[e]=this._modelSetting.getMotionGroupName(e),this._allMotionCount+=this._modelSetting.getMotionCount(t[e]);for(let e=0;e<i;e++)this.preLoadMotionGroup(t[e]);0==i&&(this._state=hs.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))}}setupTextures(){var e;if(this._state==hs.LoadTexture){let i=this._modelSetting.getTextureCount();for(let t=0;t<i;t++)""==this._modelSetting.getTextureFileName(t)?console.log("getTextureFileName null"):(e=this._modelSetting.getTextureFileName(t),e=this._modelHomeDir+e,this._subdelegate.getTextureManager().createTextureFromPngFile(e,!0,e=>{this.getRenderer().bindTexture(t,e.id),this._textureCount++,this._textureCount>=i&&(this._state=hs.CompleteSetup)}),this.getRenderer().setIsPremultipliedAlpha(!0));this._state=hs.WaitLoadTexture}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state==hs.CompleteSetup){var t=at.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion("Idle",1):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||null!=this._eyeBlink&&this._eyeBlink.updateParameters(this._model,t),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,t),null!=this._physics&&this._physics.evaluate(this._model,t),this._lipsync){var i;this._wavFileHandler.update(t),i=this._wavFileHandler.getRms();for(let e=0;e<this._lipSyncIds.getSize();++e)this._model.addParameterValueById(this._lipSyncIds.at(e),i,.8)}null!=this._pose&&this._pose.updateParameters(this._model,t),this._model.update()}}startMotion(t,i,e,s,r){if(3==e)this._motionManager.setReservePriority(e);else if(!this._motionManager.reserveMotion(e))return this._debugMode&&at.printMessage("[APP]can't start motion."),Yt;let a=this._modelSetting.getMotionFileName(t,i),n=t+"_"+i,o=this._motions.getValue(n),l=!1;if(null==o){if(fetch(""+this._modelHomeDir+a).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+a),new ArrayBuffer(0)):void 0).then(e=>{o=this.loadMotion(e,e.byteLength,null,s,r,this._modelSetting,t,i,this._motionConsistency)}),!o)return b("Can't start motion {0} .",a),this._motionManager.setReservePriority(0),Yt;o.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),l=!0}else o.setBeganMotionHandler(r),o.setFinishedMotionHandler(s);var h=this._modelSetting.getMotionSoundFileName(t,i);return 0!=h.localeCompare("")&&(h=this._modelHomeDir+(h=h),this._wavFileHandler.start(h)),this._debugMode&&at.printMessage(`[APP]start motion: [${t}_${i}]`),this._motionManager.startMotionPriority(o,l,e)}startRandomMotion(e,t,i,s){var r;return 0==this._modelSetting.getMotionCount(e)?Yt:(r=Math.floor(Math.random()*this._modelSetting.getMotionCount(e)),this.startMotion(e,r,t,i,s))}setExpression(e){var t=this._expressions.getValue(e);this._debugMode&&at.printMessage(`[APP]expression: [${e}]`),null!=t?this._expressionManager.startMotion(t,!1):this._debugMode&&at.printMessage(`[APP]expression[${e}] is null`)}setRandomExpression(){if(0!=this._expressions.getSize()){let e=Math.floor(Math.random()*this._expressions.getSize());for(let t=0;t<this._expressions.getSize();t++)if(t==e){let e=this._expressions._keyValues[t].first;return void this.setExpression(e)}}}motionEventFired(e){M("{0} is fired on LAppModel!!",e.s)}hitTest(e,i,s){if(!(this._opacity<1)){var r=this._modelSetting.getHitAreasCount();for(let t=0;t<r;t++)if(this._modelSetting.getHitAreaName(t)==e){let e=this._modelSetting.getHitAreaId(t);return this.isHit(e,i,s)}}return!1}preLoadMotionGroup(r){for(let s=0;s<this._modelSetting.getMotionCount(r);s++){let t=this._modelSetting.getMotionFileName(r,s),i=r+"_"+s;this._debugMode&&at.printMessage(`[APP]load motion: ${t} => [${i}]`),fetch(""+this._modelHomeDir+t).then(e=>e.ok?e.arrayBuffer():400<=e.status?(b("Failed to load file "+this._modelHomeDir+t),new ArrayBuffer(0)):void 0).then(e=>{e=this.loadMotion(e,e.byteLength,i,null,null,this._modelSetting,r,s,this._motionConsistency);null!=e?(e.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),null!=this._motions.getValue(i)&&Lt.delete(this._motions.getValue(i)),this._motions.setValue(i,e),this._motionCount++):this._allMotionCount--,this._motionCount>=this._allMotionCount&&(this._state=hs.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){var e;null!=this._model&&(e=[0,0,(e=this._subdelegate.getCanvas()).width,e.height],this.getRenderer().setRenderState(this._subdelegate.getFrameBuffer(),e),this.getRenderer().drawModel())}draw(e){null!=this._model&&this._state==hs.CompleteSetup&&(e.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(e),this.doDraw())}async hasMocConsistencyFromFile(){var e;if(C(this._modelSetting.getModelFileName().localeCompare("")),""!=this._modelSetting.getModelFileName())return e=this._modelSetting.getModelFileName(),e=await(await fetch(""+this._modelHomeDir+e)).arrayBuffer(),this._consistency=Ji.hasMocConsistency(e),this._consistency?M("Consistent MOC3."):M("Inconsistent MOC3."),this._consistency;at.printMessage("Model data does not exist.")}setSubdelegate(e){this._subdelegate=e}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new e,this._lipSyncIds=new e,this._motions=new I,this._expressions=new I,this._hitArea=new e,this._userArea=new e,this._idParamAngleX=$.getIdManager().getId(ot.ParamAngleX),this._idParamAngleY=$.getIdManager().getId(ot.ParamAngleY),this._idParamAngleZ=$.getIdManager().getId(ot.ParamAngleZ),this._idParamEyeBallX=$.getIdManager().getId(ot.ParamEyeBallX),this._idParamEyeBallY=$.getIdManager().getId(ot.ParamEyeBallY),this._idParamBodyAngleX=$.getIdManager().getId(ot.ParamBodyAngleX),this._mocConsistency=!0,this._motionConsistency=!0,this._state=hs.LoadAssets,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new ns,this._consistency=!1}}class ds{releaseAllModel(){this._models.clear()}onDrag(e,t){var i=this._models.at(0);i&&i.setDragging(e,t)}onTap(e,t){var i=this._models.at(0);i.hitTest("Head",e,t)?i.setRandomExpression():i.hitTest(st,e,t)&&i.startRandomMotion("TapBody",2,this.finishedMotion,this.beganMotion)}onUpdate(){var{width:e,height:t}=this._subdelegate.getCanvas(),i=new c,s=this._models.at(0);s.getModel()&&(1<s.getModel().getCanvasWidth()&&e<t?(s.getModelMatrix().setWidth(2),i.scale(1,e/t)):i.scale(t/e,1),null!=this._viewMatrix)&&i.multiplyByMatrix(this._viewMatrix),s.update(),s.draw(i)}nextScene(){var e=(this._sceneIndex+1)%it;this.changeScene(e)}changeScene(e){this._sceneIndex=e;var t=tt+et[e]+"/",e=et[e],i=(e+=".model3.json",this.releaseAllModel(),new gs);i.setSubdelegate(this._subdelegate),i.loadAssets(t,e),this._models.pushBack(i)}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}addModel(e=0){this._sceneIndex=e,this.changeScene(this._sceneIndex)}constructor(){this.beganMotion=e=>{at.printMessage("Motion Began:"),console.log(e)},this.finishedMotion=e=>{at.printMessage("Motion Finished:"),console.log(e)},this._subdelegate=null,this._viewMatrix=new c,this._models=new e,this._sceneIndex=0}release(){}initialize(e){this._subdelegate=e,this.changeScene(this._sceneIndex)}}class _s{constructor(){this._textures=new e}release(){for(var e=this._textures.begin();e.notEqual(this._textures.end());e.preIncrement())this._glManager.getGl().deleteTexture(e.ptr().id);this._textures=null}createTextureFromPngFile(i,s,r){for(let e=this._textures.begin();e.notEqual(this._textures.end());e.preIncrement())if(e.ptr().fileName==i&&e.ptr().usePremultply==s)return e.ptr().img=new Image,e.ptr().img.addEventListener("load",()=>r(e.ptr()),{passive:!0}),void(e.ptr().img.src=i);let a=new Image;a.addEventListener("load",()=>{var e=this._glManager.getGl().createTexture(),t=(this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,e),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MIN_FILTER,this._glManager.getGl().LINEAR_MIPMAP_LINEAR),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MAG_FILTER,this._glManager.getGl().LINEAR),s&&this._glManager.getGl().pixelStorei(this._glManager.getGl().UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._glManager.getGl().texImage2D(this._glManager.getGl().TEXTURE_2D,0,this._glManager.getGl().RGBA,this._glManager.getGl().RGBA,this._glManager.getGl().UNSIGNED_BYTE,a),this._glManager.getGl().generateMipmap(this._glManager.getGl().TEXTURE_2D),this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,null),new cs);null!=t&&(t.fileName=i,t.width=a.width,t.height=a.height,t.id=e,t.img=a,t.usePremultply=s,null!=this._textures)&&this._textures.pushBack(t),r(t)},{passive:!0}),a.src=i}releaseTextures(){for(let e=0;e<this._textures.getSize();e++)this._glManager.getGl().deleteTexture(this._textures.at(e).id),this._textures.set(e,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._glManager.getGl().deleteTexture(this._textures.at(e).id),this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._glManager.getGl().deleteTexture(this._textures.at(e).id),this._textures.set(e,null),this._textures.remove(e);break}}setGlManager(e){this._glManager=e}}class cs{constructor(){this.id=null,this.width=0,this.height=0}}class ms extends c{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(e,t){this._tr[0]*this._maxLeft+(this._tr[12]+e)>this._screenLeft&&(e=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+e)<this._screenRight&&(e=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+t)<this._screenTop&&(t=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+t)>this._screenBottom&&(t=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);c.multiply(e,this._tr,this._tr)}adjustScale(e,t,i){var s=this.getMaxScale(),r=this.getMinScale(),a=i*this._tr[0],r=(a<r?0<this._tr[0]&&(i=r/this._tr[0]):s<a&&0<this._tr[0]&&(i=s/this._tr[0]),new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1])),a=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-e,-t,0,1]);c.multiply(s,this._tr,this._tr),c.multiply(a,this._tr,this._tr),c.multiply(r,this._tr,this._tr)}setScreenRect(e,t,i,s){this._screenLeft=e,this._screenRight=t,this._screenBottom=i,this._screenTop=s}setMaxScreenRect(e,t,i,s){this._maxLeft=e,this._maxRight=t,this._maxTop=s,this._maxBottom=i}setMaxScale(e){this._maxScale=e}setMinScale(e){this._minScale=e}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}(us=us||{}).CubismViewMatrix=ms;class ps{constructor(e,t,i,s,r){this._rect=new fs,this._rect.left=e-.5*i,this._rect.right=e+.5*i,this._rect.up=t+.5*s,this._rect.down=t-.5*s,this._texture=r,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null;var e=this._subdelegate.getGlManager().getGl();e.deleteTexture(this._texture),this._texture=null,e.deleteBuffer(this._uvBuffer),this._uvBuffer=null,e.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,e.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(e){if(null!=this._texture){var i=this._subdelegate.getGlManager().getGl();if(this._firstDraw){this._positionLocation=i.getAttribLocation(e,"position"),i.enableVertexAttribArray(this._positionLocation),this._uvLocation=i.getAttribLocation(e,"uv"),i.enableVertexAttribArray(this._uvLocation),this._textureLocation=i.getUniformLocation(e,"texture"),i.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=i.createBuffer();{let e=this._subdelegate.getCanvas().width,t=this._subdelegate.getCanvas().height;this._positionArray=new Float32Array([(this._rect.right-.5*e)/(.5*e),(this._rect.up-.5*t)/(.5*t),(this._rect.left-.5*e)/(.5*e),(this._rect.up-.5*t)/(.5*t),(this._rect.left-.5*e)/(.5*e),(this._rect.down-.5*t)/(.5*t),(this._rect.right-.5*e)/(.5*e),(this._rect.down-.5*t)/(.5*t)]),this._vertexBuffer=i.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=i.createBuffer(),this._firstDraw=!1}i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this._uvArray,i.STATIC_DRAW),i.vertexAttribPointer(this._uvLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this._positionArray,i.STATIC_DRAW),i.vertexAttribPointer(this._positionLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._indexArray,i.DYNAMIC_DRAW),i.bindTexture(i.TEXTURE_2D,this._texture),i.drawElements(i.TRIANGLES,this._indexArray.length,i.UNSIGNED_SHORT,0)}}isHit(e,t){var i=this._subdelegate.getCanvas().height,i=i-t;return e>=this._rect.left&&e<=this._rect.right&&i<=this._rect.up&&i>=this._rect.down}setSubdelegate(e){this._subdelegate=e}}class fs{}class ys{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(e,t){this._lastX=e,this._lastY=t,this._startX=e,this._startY=t,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(e,t){this._lastX=e,this._lastY=t,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(e,t,i,s){return Math.sqrt((e-i)*(e-i)+(t-s)*(t-s))}calculateMovingAmount(e,t){return 0<e!=0<t?0:(0<e?1:-1)*((e=Math.abs(e))<(t=Math.abs(t))?e:t)}}class Ss{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new ys,this._deviceToScreen=new c,this._viewMatrix=new ms}initialize(e){var{width:t,height:i}=(this._subdelegate=e).getCanvas(),e=t/i,s=-e,r=e;if(this._viewMatrix.setScreenRect(s,r,-1,1),this._viewMatrix.scale(1,1),this._deviceToScreen.loadIdentity(),i<t){let e=Math.abs(r-s);this._deviceToScreen.scaleRelative(e/t,-e/t)}else{let e=Math.abs(2);this._deviceToScreen.scaleRelative(e/i,-e/i)}this._deviceToScreen.translateRelative(.5*-t,.5*-i),this._viewMatrix.setMaxScale(2),this._viewMatrix.setMinScale(.8),this._viewMatrix.setMaxScreenRect(-2,2,-2,2)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,this._subdelegate.getGlManager().getGl().deleteProgram(this._programId),this._programId=null}render(){this._subdelegate.getGlManager().getGl().useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),this._subdelegate.getGlManager().getGl().flush();var e=this._subdelegate.getLive2DManager();null!=e&&(e.setViewMatrix(this._viewMatrix),e.onUpdate())}initializeSprite(){let a=this._subdelegate.getCanvas().width,n=this._subdelegate.getCanvas().height,e=this._subdelegate.getTextureManager(),t=tt;var i="back_class_normal.png";e.createTextureFromPngFile(t+i,!1,e=>{var t=.5*a,i=.5*n,s=2*e.width,r=.95*n;this._back=new ps(t,i,s,r,e.id),this._back.setSubdelegate(this._subdelegate)}),e.createTextureFromPngFile(t+"icon_gear.png",!1,e=>{var t=a-.5*e.width,i=n-.5*e.height,s=e.width,r=e.height;this._gear=new ps(t,i,s,r,e.id),this._gear.setSubdelegate(this._subdelegate)}),null==this._programId&&(this._programId=this._subdelegate.createShader())}onTouchesBegan(e,t){this._touchManager.touchesBegan(e*window.devicePixelRatio,t*window.devicePixelRatio)}onTouchesMoved(e,t){var e=e*window.devicePixelRatio,t=t*window.devicePixelRatio,i=this._subdelegate.getLive2DManager(),s=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(e,t),i.onDrag(s,r)}onTouchesEnded(e,t){var e=e*window.devicePixelRatio,t=t*window.devicePixelRatio,i=this._subdelegate.getLive2DManager(),s=(i.onDrag(0,0),this.transformViewX(e)),r=this.transformViewY(t);i.onTap(s,r),this._gear.isHit(e,t)&&i.nextScene()}transformViewX(e){e=this._deviceToScreen.transformX(e);return this._viewMatrix.invertTransformX(e)}transformViewY(e){e=this._deviceToScreen.transformY(e);return this._viewMatrix.invertTransformY(e)}transformScreenX(e){return this._deviceToScreen.transformX(e)}transformScreenY(e){return this._deviceToScreen.transformY(e)}}class Cs{constructor(){this._canvas=null,this._glManager=new nt,this._textureManager=new _s,this._live2dManager=new ds,this._view=new Ss,this._frameBuffer=null,this._captured=!1}release(){this._resizeObserver.unobserve(this._canvas),this._resizeObserver.disconnect(),this._resizeObserver=null,this._live2dManager.release(),this._live2dManager=null,this._view.release(),this._view=null,this._textureManager.release(),this._textureManager=null,this._glManager.release(),this._glManager=null}initialize(e){if(!this._glManager.initialize(e))return!1;this._canvas=e,this.resizeCanvas(),this._textureManager.setGlManager(this._glManager);e=this._glManager.getGl();return this._frameBuffer||(this._frameBuffer=e.getParameter(e.FRAMEBUFFER_BINDING)),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._view.initialize(this),this._view.initializeSprite(),this._live2dManager.initialize(this),this._resizeObserver=new ResizeObserver((e,t)=>this.resizeObserverCallback.call(this,e,t)),this._resizeObserver.observe(this._canvas),!0}onResize(){this.resizeCanvas(),this._view.initialize(this),this._view.initializeSprite()}resizeObserverCallback(e,t){this._needResize=!0}update(){var e;this._glManager.getGl().isContextLost()||(this._needResize&&(this.onResize(),this._needResize=!1),(e=this._glManager.getGl()).clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.clearDepth(1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._view.render())}createShader(){var e=this._glManager.getGl(),t=e.createShader(e.VERTEX_SHADER);if(null==t)return at.printMessage("failed to create vertexShader"),null;e.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),e.compileShader(t);var i=e.createShader(e.FRAGMENT_SHADER);if(null==i)return at.printMessage("failed to create fragmentShader"),null;e.shaderSource(i,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),e.compileShader(i);var s=e.createProgram();return e.attachShader(s,t),e.attachShader(s,i),e.deleteShader(t),e.deleteShader(i),e.linkProgram(s),e.useProgram(s),s}getTextureManager(){return this._textureManager}getFrameBuffer(){return this._frameBuffer}getCanvas(){return this._canvas}getGlManager(){return this._glManager}getLive2DManager(){return this._live2dManager}resizeCanvas(){this._canvas.width=this._canvas.clientWidth*window.devicePixelRatio,this._canvas.height=this._canvas.clientHeight*window.devicePixelRatio;var e=this._glManager.getGl();e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)}onPointBegan(e,t){this._view?(this._captured=!0,e-=this._canvas.offsetLeft,t-=this._canvas.offsetTop,this._view.onTouchesBegan(e,t)):at.printMessage("view notfound")}onPointMoved(e,t){this._captured&&(e=e-this._canvas.offsetLeft,t=t-this._canvas.offsetTop,this._view.onTouchesMoved(e,t))}onPointEnded(e,t){this._captured=!1,this._view?(e-=this._canvas.offsetLeft,t-=this._canvas.offsetTop,this._view.onTouchesEnded(e,t)):at.printMessage("view notfound")}onTouchCancel(e,t){this._captured=!1,this._view?(e-=this._canvas.offsetLeft,t-=this._canvas.offsetTop,this._view.onTouchesEnded(e,t)):at.printMessage("view notfound")}isContextLost(){return this._glManager.getGl().isContextLost()}}let xs=null;class Ms{static getInstance(){return xs=null==xs?new Ms:xs}static releaseInstance(){null!=xs&&xs.release(),xs=null}onPointerBegan(e){for(var t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().onPointBegan(e.pageX,e.pageY)}onPointerMoved(e){for(var t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().onPointMoved(e.pageX,e.pageY)}onPointerEnded(e){for(var t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().onPointEnded(e.pageX,e.pageY)}onPointerCancel(e){for(var t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().onTouchCancel(e.pageX,e.pageY)}onResize(){for(let e=0;e<this._subdelegates.getSize();e++)this._subdelegates.at(e).onResize()}run(){let e=()=>{if(null!=xs){at.updateTime();for(let e=0;e<this._subdelegates.getSize();e++)this._subdelegates.at(e).update();requestAnimationFrame(e)}};e()}release(){this.releaseEventListener(),this.releaseSubdelegates(),$.dispose(),this._cubismOption=null}releaseEventListener(){document.removeEventListener("pointerup",this.pointBeganEventListener),this.pointBeganEventListener=null,document.removeEventListener("pointermove",this.pointMovedEventListener),this.pointMovedEventListener=null,document.removeEventListener("pointerdown",this.pointEndedEventListener),this.pointEndedEventListener=null,document.removeEventListener("pointerdown",this.pointCancelEventListener),this.pointCancelEventListener=null}releaseSubdelegates(){for(var e=this._subdelegates.begin();e.notEqual(this._subdelegates.end());e.preIncrement())e.ptr().release();this._subdelegates.clear(),this._subdelegates=null}initialize(){return this.initializeCubism(),this.initializeSubdelegates(),this.initializeEventListener(),!0}initializeEventListener(){this.pointBeganEventListener=this.onPointerBegan.bind(this),this.pointMovedEventListener=this.onPointerMoved.bind(this),this.pointEndedEventListener=this.onPointerEnded.bind(this),this.pointCancelEventListener=this.onPointerCancel.bind(this),document.addEventListener("pointerdown",this.pointBeganEventListener,{passive:!0}),document.addEventListener("pointermove",this.pointMovedEventListener,{passive:!0}),document.addEventListener("pointerup",this.pointEndedEventListener,{passive:!0}),document.addEventListener("pointercancel",this.pointCancelEventListener,{passive:!0})}initializeCubism(){at.updateTime(),this._cubismOption.logFunction=at.printMessage,this._cubismOption.loggingLevel=rt,$.startUp(this._cubismOption),$.initialize()}initializeSubdelegates(){let e=100;e=100,this._canvases.prepareCapacity(1),this._subdelegates.prepareCapacity(1);for(let e=0;e<1;e++){let e=document.createElement("canvas");this._canvases.pushBack(e),e.style.width="100vw",e.style.height="100vh",document.body.appendChild(e)}for(let e=0;e<this._canvases.getSize();e++){var t=new Cs;t.initialize(this._canvases.at(e)),this._subdelegates.pushBack(t)}for(let e=0;e<1;e++)this._subdelegates.at(e).isContextLost()&&b(`The context for Canvas at index ${e} was lost, possibly because the acquisition limit for WebGLRenderingContext was reached.`)}constructor(){this._cubismOption=new Z,this._subdelegates=new e,this._canvases=new e}}at.printMessage=()=>{};class vs extends Cs{initialize(e){if(!this._glManager.initialize(e))return!1;this._canvas=e,this.resizeCanvas(),this._textureManager.setGlManager(this._glManager);e=this._glManager.getGl();return this._frameBuffer||(this._frameBuffer=e.getParameter(e.FRAMEBUFFER_BINDING)),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._view.initialize(this),this._view._gear={render:()=>{},isHit:()=>{},release:()=>{}},this._view._back={render:()=>{},release:()=>{}},(this._live2dManager._subdelegate=this)._resizeObserver=new window.ResizeObserver((e,t)=>this.resizeObserverCallback.call(this,e,t)),this._resizeObserver.observe(this._canvas),!0}onResize(){this.resizeCanvas(),this._view.initialize(this)}update(){var e;this._glManager.getGl().isContextLost()||(this._needResize&&(this.onResize(),this._needResize=!1),(e=this._glManager.getGl()).clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.clearDepth(1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._view.render())}}class bs extends Ms{run(){let e=()=>{at.updateTime();for(let e=0;e<this._subdelegates.getSize();e++)this._subdelegates.at(e).update();this._drawFrameId=window.requestAnimationFrame(e)};e()}stop(){this._drawFrameId&&(window.cancelAnimationFrame(this._drawFrameId),this._drawFrameId=null)}release(){this.stop(),this.releaseEventListener(),this._subdelegates.clear(),this._cubismOption=null}transformOffset(e){var t=this._subdelegates.at(0),i=t.getCanvas().getBoundingClientRect(),s=(e.pageX-i.left)*window.devicePixelRatio,e=(e.pageY-i.top)*window.devicePixelRatio;return{x:t._view.transformViewX(s),y:t._view.transformViewY(e)}}onMouseMove(e){var t=this._subdelegates.at(0).getLive2DManager(),{x:e,y:i}=this.transformOffset(e),s=t._models.at(0);t.onDrag(e,i),t.onTap(e,i),s.hitTest(st,e,i)&&window.dispatchEvent(new Event("live2d:hoverbody"))}onMouseEnd(e){var t=this._subdelegates.at(0).getLive2DManager(),{x:e,y:i}=this.transformOffset(e);t.onDrag(0,0),t.onTap(e,i)}onTap(e){var t=this._subdelegates.at(0).getLive2DManager(),{x:e,y:i}=this.transformOffset(e);t._models.at(0).hitTest(st,e,i)&&window.dispatchEvent(new Event("live2d:tapbody"))}initializeEventListener(){this.mouseMoveEventListener=this.onMouseMove.bind(this),this.mouseEndedEventListener=this.onMouseEnd.bind(this),this.tapEventListener=this.onTap.bind(this),document.addEventListener("mousemove",this.mouseMoveEventListener,{passive:!0}),document.addEventListener("mouseout",this.mouseEndedEventListener,{passive:!0}),document.addEventListener("pointerdown",this.tapEventListener,{passive:!0})}releaseEventListener(){document.removeEventListener("mousemove",this.mouseMoveEventListener,{passive:!0}),this.mouseMoveEventListener=null,document.removeEventListener("mouseout",this.mouseEndedEventListener,{passive:!0}),this.mouseEndedEventListener=null,document.removeEventListener("pointerdown",this.tapEventListener,{passive:!0})}initializeSubdelegates(){this._canvases.prepareCapacity(1),this._subdelegates.prepareCapacity(1);var e=document.getElementById("live2d");this._canvases.pushBack(e),e.style.width=e.width,e.style.height=e.height;for(let e=0;e<this._canvases.getSize();e++){var i=new vs;if(!i.initialize(this._canvases.at(e)))return void t.error("Failed to initialize AppSubdelegate");this._subdelegates.pushBack(i)}for(let e=0;e<1;e++)this._subdelegates.at(e).isContextLost()&&t.error(`The context for Canvas at index ${e} was lost, possibly because the acquisition limit for WebGLRenderingContext was reached.`)}changeModel(e){var e=e.split("/"),t=e.pop(),e=e.join("/")+"/",i=this._subdelegates.at(0).getLive2DManager(),s=(i.releaseAllModel(),new gs);s.setSubdelegate(i._subdelegate),s.loadAssets(e,t),i._models.pushBack(s)}get subdelegates(){return this._subdelegates}}export{bs as AppDelegate};