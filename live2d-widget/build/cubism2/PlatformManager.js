import logger from"../logger.js";class PlatformManager{constructor(){this.cache={}}loadBytes(r,t){if(r in this.cache)return t(this.cache[r]);fetch(r).then(e=>e.arrayBuffer()).then(e=>{this.cache[r]=e,t(e)})}loadLive2DModel(e,r){let t;this.loadBytes(e,e=>{t=Live2DModelWebGL.loadModel(e),r(t)})}loadTexture(t,a,e,o){let l=new Image;l.crossOrigin="anonymous",l.src=e,l.onload=()=>{var e=document.getElementById("live2d").getContext("webgl2",{premultipliedAlpha:!0,preserveDrawingBuffer:!0}),r=e.createTexture();if(!r)return logger.error("Failed to generate gl texture name."),-1;0==t.isPremultipliedAlpha()&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D),t.setTexture(a,r),"function"==typeof o&&o()},l.onerror=()=>{logger.error("Failed to load image : "+e)}}jsonParseFromBytes(e){let r;var t=new Uint8Array(e,0,3),t=(r=239==t[0]&&187==t[1]&&191==t[2]?String.fromCharCode.apply(null,new Uint8Array(e,3)):String.fromCharCode.apply(null,new Uint8Array(e)),JSON.parse(r));return t}}export default PlatformManager;