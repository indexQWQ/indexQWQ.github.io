import{CubismBreath}from"../effect/cubismbreath";import{CubismEyeBlink}from"../effect/cubismeyeblink";import{CubismPose}from"../effect/cubismpose";import{Constant}from"../live2dcubismframework";import{CubismModelMatrix}from"../math/cubismmodelmatrix";import{CubismTargetPoint}from"../math/cubismtargetpoint";import{CubismExpressionMotion}from"../motion/cubismexpressionmotion";import{CubismExpressionMotionManager}from"../motion/cubismexpressionmotionmanager";import{CubismMotion}from"../motion/cubismmotion";import{CubismMotionManager}from"../motion/cubismmotionmanager";import{CubismPhysics}from"../physics/cubismphysics";import{CubismRenderer_WebGL}from"../rendering/cubismrenderer_webgl";import{CubismLogError,CubismLogInfo}from"../utils/cubismdebug";import{CubismMoc}from"./cubismmoc";import{CubismModelUserData}from"./cubismmodeluserdata";class CubismUserModel{isInitialized(){return this._initialized}setInitialized(e){this._initialized=e}isUpdating(){return this._updating}setUpdating(e){this._updating=e}setDragging(e,i){this._dragManager.set(e,i)}setAcceleration(e,i,t){this._accelerationX=e,this._accelerationY=i,this._accelerationZ=t}getModelMatrix(){return this._modelMatrix}setOpacity(e){this._opacity=e}getOpacity(){return this._opacity}loadModel(e,i=!1){this._moc=CubismMoc.create(e,i),null==this._moc?CubismLogError("Failed to CubismMoc.create()."):(this._model=this._moc.createModel(),null==this._model?CubismLogError("Failed to CreateModel()."):(this._model.saveParameters(),this._modelMatrix=new CubismModelMatrix(this._model.getCanvasWidth(),this._model.getCanvasHeight())))}loadMotion(e,i,t,s,r,o,a,n,l=!1){return null==e||0==i?(CubismLogError("Failed to loadMotion()."),null):null==(e=CubismMotion.create(e,i,s,r,l))?(CubismLogError("Failed to create motion from buffer in LoadMotion()"),null):(o&&(0<=(i=o.getMotionFadeInTimeValue(a,n))&&e.setFadeInTime(i),0<=(s=o.getMotionFadeOutTimeValue(a,n)))&&e.setFadeOutTime(s),e)}loadExpression(e,i,t){return null==e||0==i?(CubismLogError("Failed to loadExpression()."),null):CubismExpressionMotion.create(e,i)}loadPose(e,i){null==e||0==i?CubismLogError("Failed to loadPose()."):this._pose=CubismPose.create(e,i)}loadUserData(e,i){null==e||0==i?CubismLogError("Failed to loadUserData()."):this._modelUserData=CubismModelUserData.create(e,i)}loadPhysics(e,i){null==e||0==i?CubismLogError("Failed to loadPhysics()."):this._physics=CubismPhysics.create(e,i)}isHit(e,i,t){e=this._model.getDrawableIndex(e);if(e<0)return!1;var s=this._model.getDrawableVertexCount(e),r=this._model.getDrawableVertices(e);let o=r[0],a=r[0],n=r[1],l=r[1];for(let e=1;e<s;++e){var m=r[Constant.vertexOffset+e*Constant.vertexStep],u=r[Constant.vertexOffset+e*Constant.vertexStep+1];m<o&&(o=m),m>a&&(a=m),u<n&&(n=u),u>l&&(l=u)}e=this._modelMatrix.invertTransformX(i),i=this._modelMatrix.invertTransformY(t);return o<=e&&e<=a&&n<=i&&i<=l}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(e=1){this._renderer&&this.deleteRenderer(),this._renderer=new CubismRenderer_WebGL,this._renderer.initialize(this._model,e)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(e){CubismLogInfo("{0}",e.s)}static cubismDefaultMotionEventCallback(e,i,t){null!=t&&t.motionEventFired(i)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new CubismMotionManager,this._motionManager.setEventCallback(CubismUserModel.cubismDefaultMotionEventCallback,this),this._expressionManager=new CubismExpressionMotionManager,this._dragManager=new CubismTargetPoint}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,CubismPose.delete(this._pose),CubismEyeBlink.delete(this._eyeBlink),CubismBreath.delete(this._breath),this._dragManager=null,CubismPhysics.delete(this._physics),CubismModelUserData.delete(this._modelUserData),this.deleteRenderer()}}import*as $ from"./cubismusermodel";var Live2DCubismFramework;(Live2DCubismFramework=Live2DCubismFramework||{}).CubismUserModel=$.CubismUserModel;export{CubismUserModel,Live2DCubismFramework};