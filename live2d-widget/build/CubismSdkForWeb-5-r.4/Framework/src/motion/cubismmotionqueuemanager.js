import{CubismMotionQueueEntry}from"./cubismmotionqueueentry";import{csmVector}from"../type/csmvector";class CubismMotionQueueManager{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new csmVector}release(){for(let e=0;e<this._motions.getSize();++e)this._motions.at(e)&&(this._motions.at(e).release(),this._motions.set(e,null));this._motions=null}startMotion(e,t,n){if(null==e)return InvalidMotionQueueEntryHandleValue;let i=null;for(let e=0;e<this._motions.getSize();++e)null!=(i=this._motions.at(e))&&i.setFadeOut(i._motion.getFadeOutTime());return(i=new CubismMotionQueueEntry)._autoDelete=t,i._motion=e,this._motions.pushBack(i),i._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e)t=this._motions.erase(t);else if(null==e._motion)e.release(),e=null,t=this._motions.erase(t);else{if(!e.isFinished())return!1;t.preIncrement()}}return!0}isFinishedByHandle(e){for(var t=this._motions.begin();t.notEqual(this._motions.end());t.increment()){var n=t.ptr();if(null!=n&&(n._motionQueueEntryHandle==e&&!n.isFinished()))return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();null==e?t=this._motions.erase(t):(e.release(),e=null,t=this._motions.erase(t))}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(e){for(var t=this._motions.begin();t.notEqual(this._motions.end());t.preIncrement()){var n=t.ptr();if(null!=n&&n._motionQueueEntryHandle==e)return n}return null}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(n,i){let o=!1;for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e)t=this._motions.erase(t);else{var s=e._motion;if(null==s)e.release(),e=null,t=this._motions.erase(t);else{s.updateParameters(n,e,i),o=!0;var r=s.getFiredEvent(e.getLastCheckEventSeconds()-e.getStartTime(),i-e.getStartTime());for(let e=0;e<r.getSize();++e)this._eventCallBack(this,r.at(e),this._eventCustomData);e.setLastCheckEventSeconds(i),e.isFinished()?(e.release(),e=null,t=this._motions.erase(t)):(e.isTriggeredFadeOut()&&e.startFadeOut(e.getFadeOutSeconds(),i),t.preIncrement())}}}return o}}let InvalidMotionQueueEntryHandleValue=-1;import*as $ from"./cubismmotionqueuemanager";var Live2DCubismFramework;(e=>{e.CubismMotionQueueManager=$.CubismMotionQueueManager,e.InvalidMotionQueueEntryHandleValue=$.InvalidMotionQueueEntryHandleValue})(Live2DCubismFramework=Live2DCubismFramework||{});export{CubismMotionQueueManager,InvalidMotionQueueEntryHandleValue,Live2DCubismFramework};