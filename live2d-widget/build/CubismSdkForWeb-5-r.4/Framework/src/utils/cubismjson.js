import{strtod}from"../live2dcubismframework";import{csmMap}from"../type/csmmap";import{csmString}from"../type/csmstring";import{csmVector}from"../type/csmvector";import{CubismLogInfo}from"./cubismdebug";let CSM_JSON_ERROR_TYPE_MISMATCH="Error: type mismatch",CSM_JSON_ERROR_INDEX_OF_BOUNDS="Error: index out of bounds";class Value{constructor(){}getRawString(r,e){return this.getString(r,e)}toInt(r=0){return r}toFloat(r=0){return r}toBoolean(r=!1){return r}getSize(){return 0}getArray(r=null){return r}getVector(r=new csmVector){return r}getMap(r){return r}getValueByIndex(r){return Value.errorValue.setErrorNotForClientCall(CSM_JSON_ERROR_TYPE_MISMATCH)}getValueByString(r){return Value.nullValue.setErrorNotForClientCall(CSM_JSON_ERROR_TYPE_MISMATCH)}getKeys(){return Value.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(r){return!1}isStatic(){return!1}setErrorNotForClientCall(r){return JsonError.errorValue}static staticInitializeNotForClientCall(){JsonBoolean.trueValue=new JsonBoolean(!0),JsonBoolean.falseValue=new JsonBoolean(!1),Value.errorValue=new JsonError("ERROR",!0),Value.nullValue=new JsonNullvalue,Value.dummyKeys=new csmVector}static staticReleaseNotForClientCall(){JsonBoolean.trueValue=null,JsonBoolean.falseValue=null,Value.errorValue=null,Value.nullValue=null,Value.dummyKeys=null}}class CubismJson{constructor(r,e){this._parseCallback=CubismJsonExtension.parseJsonObject,this._error=null,this._lineCount=0,(this._root=null)!=r&&this.parseBytes(r,e,this._parseCallback)}static create(r,e){var t=new CubismJson;return t.parseBytes(r,e,t._parseCallback)?t:(CubismJson.delete(t),null)}static delete(r){}getRoot(){return this._root}static arrayBufferToString(r){var t=new Uint8Array(r);let s="";for(let r=0,e=t.length;r<e;++r)s+="%"+this.pad(t[r].toString(16));return s=decodeURIComponent(s)}static pad(r){return r.length<2?"0"+r:r}parseBytes(r,e,t){var s=new Array(1),r=CubismJson.arrayBufferToString(r);return this._root=null==t?this.parseValue(r,e,0,s):t(JSON.parse(r),new JsonMap),this._error?(e="\0",e="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new JsonString(e),CubismLogInfo("{0}",this._root.getRawString()),!1):null!=this._root||(this._root=new JsonError(new csmString(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,s,n,a){if(!this._error){let r=null,e=n;for(;e<s;e++)switch(t[e]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":var i=new Array(1),o=strtod(t.slice(e),i);return a[0]=t.indexOf(i[0]),new JsonFloat(o);case'"':return new JsonString(this.parseString(t,s,e+1,a));case"[":return r=this.parseArray(t,s,e+1,a);case"{":return r=this.parseObject(t,s,e+1,a);case"n":return e+3<s?(r=new JsonNullvalue,a[0]=e+4):this._error="parse null",r;case"t":return e+3<s?(r=JsonBoolean.trueValue,a[0]=e+4):this._error="parse true",r;case"f":return e+4<s?(r=JsonBoolean.falseValue,a[0]=e+5):this._error="illegal ',' position",r;case",":return this._error="illegal ',' position",null;case"]":return a[0]=e,null;case"\n":this._lineCount++}this._error="illegal end of value"}return null}parseString(t,s,n,a){if(!this._error)if(t){let r=n;var i=new csmString("");let e=n;for(;r<s;r++)switch(t[r]){case'"':return a[0]=r+1,i.append(t.slice(e),r-e),i.s;case"//":if(++r-1>e&&i.append(t.slice(e),r-e),e=r+1,r<s)switch(t[r]){case"\\":i.expansion(1,"\\");break;case'"':i.expansion(1,'"');break;case"/":i.expansion(1,"/");break;case"b":i.expansion(1,"\b");break;case"f":i.expansion(1,"\f");break;case"n":i.expansion(1,"\n");break;case"r":i.expansion(1,"\r");break;case"t":i.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}this._error="parse string/illegal end"}else this._error="string is null";return null}parseObject(n,a,i,o){if(!this._error)if(n){var l=new JsonMap;let r="",e=i,t="";var u=Array(1);let s=!1;for(;e<a;e++){r:for(;e<a;e++)switch(t=n[e]){case'"':if(r=this.parseString(n,a,e+1,u),this._error)return null;e=u[0],s=!0;break r;case"}":return o[0]=e+1,l;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!s)return this._error="key not found",null;s=!1;r:for(;e<a;e++)switch(t=n[e]){case":":s=!0,e++;break r;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!s)return this._error="':' not found",null;var c=this.parseValue(n,a,e,u);if(this._error)return null;e=u[0],l.put(r,c);r:for(;e<a;e++)switch(t=n[e]){case",":break r;case"}":return o[0]=e+1,l;case"\n":this._lineCount++}}this._error="illegal end of perseObject"}else this._error="buffer is null";return null}parseArray(t,s,n,a){if(!this._error)if(t){let r=new JsonArray,e=n;for(var i=new Array(1);e<s;e++){var o=this.parseValue(t,s,e,i);if(this._error)return null;e=i[0],o&&r.add(o);r:for(;e<s;e++)switch(t[e]){case",":break r;case"]":return a[0]=e+1,r;case"\n":++this._lineCount}}r=void 0,this._error="illegal end of parseObject"}else this._error="buffer is null";return null}}class JsonFloat extends Value{constructor(r){super(),this._value=r}isFloat(){return!0}getString(r,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(r=0){return parseInt(this._value.toString())}toFloat(r=0){return this._value}equals(r){return"number"==typeof r&&!Math.round(r)&&r==this._value}}class JsonBoolean extends Value{isBool(){return!0}toBoolean(r=0){return this._boolValue}getString(r,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(r){return"boolean"==typeof r&&r==this._boolValue}isStatic(){return!0}constructor(r){super(),this._boolValue=r}}class JsonString extends Value{constructor(r){super(),"string"==typeof r&&(this._stringBuffer=r),r instanceof csmString&&(this._stringBuffer=r.s)}isString(){return!0}getString(r,e){return this._stringBuffer}equals(r){return"string"==typeof r?this._stringBuffer==r:r instanceof csmString&&this._stringBuffer==r.s}}class JsonError extends JsonString{isStatic(){return this._isStatic}setErrorNotForClientCall(r){return this._stringBuffer=r,this}constructor(r,e){super(r),this._isStatic=e}isError(){return!0}}class JsonNullvalue extends Value{isNull(){return!0}getString(r,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(r){return this._stringBuffer=r,JsonError.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class JsonArray extends Value{constructor(){super(),this._array=new csmVector}release(){for(var e=this._array.begin();e.notEqual(this._array.end());e.preIncrement()){let r=e.ptr();r&&!r.isStatic()&&(r=void 0,r=null)}}isArray(){return!0}getValueByIndex(r){return r<0||this._array.getSize()<=r?Value.errorValue.setErrorNotForClientCall(CSM_JSON_ERROR_INDEX_OF_BOUNDS):null==(r=this._array.at(r))?Value.nullValue:r}getValueByString(r){return Value.errorValue.setErrorNotForClientCall(CSM_JSON_ERROR_TYPE_MISMATCH)}getString(r,e){for(var t=e+"[\n",s=this._array.begin();s.notEqual(this._array.end());s.increment()){var n=s.ptr();this._stringBuffer+=e+""+n.getString(e+" ")+"\n"}return this._stringBuffer=t+e+"]\n",this._stringBuffer}add(r){this._array.pushBack(r)}getVector(r=0){return this._array}getSize(){return this._array.getSize()}}class JsonMap extends Value{constructor(){super(),this._map=new csmMap}release(){for(var e=this._map.begin();e.notEqual(this._map.end());){let r=e.ptr().second;r&&!r.isStatic()&&(r=void 0,r=null),e.preIncrement()}}isMap(){return!0}getValueByString(r){var e;if(r instanceof csmString)return null==(e=this._map.getValue(r.s))?Value.nullValue:e;for(var t=this._map.begin();t.notEqual(this._map.end());t.preIncrement())if(t.ptr().first==r)return null==t.ptr().second?Value.nullValue:t.ptr().second;return Value.nullValue}getValueByIndex(r){return Value.errorValue.setErrorNotForClientCall(CSM_JSON_ERROR_TYPE_MISMATCH)}getString(r,e){this._stringBuffer=e+"{\n";for(var t=this._map.begin();t.notEqual(this._map.end());){var s=t.ptr().first,n=t.ptr().second;this._stringBuffer+=e+" "+s+" : "+n.getString(e+"   ")+" \n",t.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer}getMap(r){return this._map}put(r,e){this._map.setValue(r,e)}getKeys(){if(!this._keys){this._keys=new csmVector;for(var r=this._map.begin();r.notEqual(this._map.end());){var e=r.ptr().first;this._keys.pushBack(e),r.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}import*as $ from"./cubismjson";import{CubismJsonExtension}from"./cubismjsonextension";var Live2DCubismFramework;(r=>{r.CubismJson=$.CubismJson,r.JsonArray=$.JsonArray,r.JsonBoolean=$.JsonBoolean,r.JsonError=$.JsonError,r.JsonFloat=$.JsonFloat,r.JsonMap=$.JsonMap,r.JsonNullvalue=$.JsonNullvalue,r.JsonString=$.JsonString,r.Value=$.Value})(Live2DCubismFramework=Live2DCubismFramework||{});export{Value,CubismJson,JsonFloat,JsonBoolean,JsonString,JsonError,JsonNullvalue,JsonArray,JsonMap,Live2DCubismFramework};