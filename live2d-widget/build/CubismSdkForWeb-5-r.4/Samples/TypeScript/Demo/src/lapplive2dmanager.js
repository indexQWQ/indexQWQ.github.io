import{CubismMatrix44}from"@framework/math/cubismmatrix44";import{csmVector}from"@framework/type/csmvector";import*as LAppDefine from"./lappdefine";import{LAppModel}from"./lappmodel";import{LAppPal}from"./lapppal";class LAppLive2DManager{releaseAllModel(){this._models.clear()}onDrag(e,i){var t=this._models.at(0);t&&t.setDragging(e,i)}onTap(e,i){LAppDefine.DebugLogEnable&&LAppPal.printMessage(`[APP]tap point: {x: ${e.toFixed(2)} y: ${i.toFixed(2)}}`);var t=this._models.at(0);t.hitTest(LAppDefine.HitAreaNameHead,e,i)?(LAppDefine.DebugLogEnable&&LAppPal.printMessage(`[APP]hit area: [${LAppDefine.HitAreaNameHead}]`),t.setRandomExpression()):t.hitTest(LAppDefine.HitAreaNameBody,e,i)&&(LAppDefine.DebugLogEnable&&LAppPal.printMessage(`[APP]hit area: [${LAppDefine.HitAreaNameBody}]`),t.startRandomMotion(LAppDefine.MotionGroupTapBody,LAppDefine.PriorityNormal,this.finishedMotion,this.beganMotion))}onUpdate(){var{width:e,height:i}=this._subdelegate.getCanvas(),t=new CubismMatrix44,a=this._models.at(0);a.getModel()&&(1<a.getModel().getCanvasWidth()&&e<i?(a.getModelMatrix().setWidth(2),t.scale(1,e/i)):t.scale(i/e,1),null!=this._viewMatrix)&&t.multiplyByMatrix(this._viewMatrix),a.update(),a.draw(t)}nextScene(){var e=(this._sceneIndex+1)%LAppDefine.ModelDirSize;this.changeScene(e)}changeScene(e){this._sceneIndex=e,LAppDefine.DebugLogEnable&&LAppPal.printMessage("[APP]model index: "+this._sceneIndex);var i=LAppDefine.ModelDir[e],i=LAppDefine.ResourcesPath+i+"/",e=LAppDefine.ModelDir[e],t=(e+=".model3.json",this.releaseAllModel(),new LAppModel);t.setSubdelegate(this._subdelegate),t.loadAssets(i,e),this._models.pushBack(t)}setViewMatrix(i){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=i.getArray()[e]}addModel(e=0){this._sceneIndex=e,this.changeScene(this._sceneIndex)}constructor(){this.beganMotion=e=>{LAppPal.printMessage("Motion Began:"),console.log(e)},this.finishedMotion=e=>{LAppPal.printMessage("Motion Finished:"),console.log(e)},this._subdelegate=null,this._viewMatrix=new CubismMatrix44,this._models=new csmVector,this._sceneIndex=0}release(){}initialize(e){this._subdelegate=e,this.changeScene(this._sceneIndex)}}export{LAppLive2DManager};